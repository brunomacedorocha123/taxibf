<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TaxiBF - Perfil do Motorista</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- AWS SDK para S3 (Cloudflare R2) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/aws-sdk/2.1048.0/aws-sdk.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --taxi-yellow: #FFC400;
            --dark-graphite: #1C1C1C;
            --darker: #121212;
            --white: #FFFFFF;
            --gray: #2A2A2A;
            --available: #2ECC71;
            --busy: #E74C3C;
            --warning: #F39C12;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--darker);
            color: var(--white);
            line-height: 1.5;
        }

        /* NAVBAR */
        .navbar {
            background: var(--dark-graphite);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            padding: 0.8rem 1.5rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .btn-back {
            background: none;
            border: none;
            color: var(--white);
            cursor: pointer;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
        }

        .btn-back:hover {
            color: var(--taxi-yellow);
        }

        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--taxi-yellow), #FFD700);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: var(--dark-graphite);
            border: 2px solid var(--dark-graphite);
        }

        .btn-logout {
            background: none;
            border: none;
            color: #888;
            cursor: pointer;
            font-size: 1.2rem;
            padding: 0.5rem;
        }

        .btn-logout:hover {
            color: var(--busy);
        }

        /* MAIN */
        .main-content {
            margin-top: 80px;
            padding: 2rem 1.5rem;
            max-width: 1000px;
            margin-left: auto;
            margin-right: auto;
        }

        .page-header {
            margin-bottom: 2rem;
        }

        .page-header h1 {
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 0.8rem;
            color: white;
        }

        .page-header h1 i {
            color: var(--taxi-yellow);
        }

        /* PROFILE CARD */
        .profile-card {
            background: var(--dark-graphite);
            border-radius: 24px;
            padding: 2rem;
            border: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 2rem;
        }

        .photo-section {
            display: flex;
            align-items: center;
            gap: 2rem;
            flex-wrap: wrap;
        }

        .photo-upload-container {
            position: relative;
            width: 130px;
            height: 130px;
        }

        .profile-photo {
            width: 130px;
            height: 130px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid var(--taxi-yellow);
            display: none;
        }

        .profile-placeholder {
            width: 130px;
            height: 130px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--taxi-yellow), #FFD700);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--dark-graphite);
            border: 4px solid var(--taxi-yellow);
        }

        .photo-overlay {
            position: absolute;
            bottom: 5px;
            right: 5px;
            width: 38px;
            height: 38px;
            background: var(--taxi-yellow);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: 3px solid var(--dark-graphite);
            transition: transform 0.2s;
        }

        .photo-overlay:hover {
            transform: scale(1.1);
        }

        .photo-overlay i {
            color: var(--dark-graphite);
            font-size: 1rem;
        }

        #fileInput {
            display: none;
        }

        .profile-info {
            flex: 1;
        }

        .profile-name {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 0.3rem;
            color: white;
        }

        .profile-email {
            color: #888;
            margin-bottom: 0.8rem;
            font-size: 0.95rem;
        }

        .profile-status {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(46, 204, 113, 0.2);
            color: var(--available);
            padding: 0.5rem 1.2rem;
            border-radius: 30px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .profile-status.inactive {
            background: rgba(231, 76, 60, 0.2);
            color: var(--busy);
        }

        /* FORM SECTIONS */
        .form-section {
            background: var(--dark-graphite);
            border-radius: 24px;
            padding: 1.8rem;
            border: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 1.8rem;
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            margin-bottom: 1.5rem;
            padding-bottom: 0.8rem;
            border-bottom: 2px solid rgba(255,255,255,0.05);
        }

        .section-header i {
            color: var(--taxi-yellow);
            font-size: 1.2rem;
        }

        .section-header h2 {
            font-size: 1.2rem;
            font-weight: 700;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.2rem;
            margin-bottom: 1.2rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.4rem;
        }

        .form-group.full-width {
            grid-column: span 2;
        }

        label {
            font-size: 0.85rem;
            font-weight: 600;
            color: #aaa;
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        label i {
            color: var(--taxi-yellow);
            font-size: 0.85rem;
        }

        .required {
            color: var(--busy);
            margin-left: 0.2rem;
        }

        input, select, textarea {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 0.8rem 1rem;
            color: white;
            font-family: 'Inter', sans-serif;
            font-size: 0.95rem;
            transition: all 0.2s;
            width: 100%;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--taxi-yellow);
            background: rgba(255,255,255,0.08);
        }

        input::placeholder {
            color: #666;
        }

        input.error {
            border-color: var(--busy);
        }

        /* VEHICLE TYPE SELECTOR */
        .vehicle-type-selector {
            display: flex;
            gap: 1rem;
            margin-bottom: 0.5rem;
        }

        .vehicle-type-card {
            flex: 1;
            background: rgba(255,255,255,0.03);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 16px;
            padding: 1.2rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.6rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .vehicle-type-card i {
            font-size: 2rem;
            color: #888;
        }

        .vehicle-type-card span {
            font-weight: 600;
        }

        .vehicle-type-card.active {
            background: rgba(255,196,0,0.1);
            border-color: var(--taxi-yellow);
        }

        .vehicle-type-card.active i {
            color: var(--taxi-yellow);
        }

        /* PHOTOS GRID */
        .photos-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 0.8rem;
            margin-top: 0.8rem;
        }

        .photo-upload-box {
            aspect-ratio: 1/1;
            background: rgba(255,255,255,0.03);
            border: 2px dashed rgba(255,255,255,0.15);
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }

        .photo-upload-box:hover {
            border-color: var(--taxi-yellow);
            background: rgba(255,196,0,0.05);
        }

        .photo-upload-box.has-image {
            border-style: solid;
            border-color: var(--taxi-yellow);
        }

        .photo-upload-box img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            position: absolute;
            top: 0;
            left: 0;
        }

        .photo-upload-box i {
            font-size: 1.3rem;
            color: #666;
            margin-bottom: 0.2rem;
        }

        .photo-upload-box span {
            font-size: 0.65rem;
            color: #888;
            text-align: center;
            padding: 0 0.2rem;
        }

        .photo-remove {
            position: absolute;
            top: 4px;
            right: 4px;
            width: 26px;
            height: 26px;
            background: var(--busy);
            border: none;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            font-size: 0.8rem;
        }

        .photo-remove:hover {
            transform: scale(1.1);
        }

        /* DOCUMENT UPLOAD */
        .document-upload {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: rgba(255,255,255,0.03);
            border-radius: 12px;
            border: 2px dashed rgba(255,255,255,0.15);
            cursor: pointer;
            transition: all 0.2s;
        }

        .document-upload:hover {
            border-color: var(--taxi-yellow);
            background: rgba(255,196,0,0.05);
        }

        .document-icon {
            width: 45px;
            height: 45px;
            background: rgba(255,196,0,0.1);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--taxi-yellow);
            font-size: 1.3rem;
        }

        .document-info {
            flex: 1;
        }

        .document-info h4 {
            font-size: 0.95rem;
            margin-bottom: 0.2rem;
        }

        .document-info p {
            font-size: 0.75rem;
            color: #888;
        }

        .document-status {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            font-size: 0.75rem;
            font-weight: 600;
            padding: 0.3rem 0.8rem;
            border-radius: 30px;
            background: rgba(243, 156, 18, 0.1);
            color: var(--warning);
        }

        /* TOGGLE */
        .toggle-group {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
            background: rgba(255,255,255,0.03);
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.05);
        }

        .toggle-info h4 {
            font-size: 0.95rem;
            margin-bottom: 0.2rem;
        }

        .toggle-info p {
            font-size: 0.75rem;
            color: #888;
        }

        .toggle-switch {
            position: relative;
            width: 52px;
            height: 28px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255,255,255,0.1);
            transition: 0.2s;
            border-radius: 34px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 3px;
            bottom: 3px;
            background: white;
            transition: 0.2s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background: var(--taxi-yellow);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(24px);
            background: var(--dark-graphite);
        }

        /* BUTTONS */
        .form-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 1.5rem;
        }

        .btn-primary {
            padding: 0.9rem 2rem;
            border: none;
            background: var(--taxi-yellow);
            color: var(--dark-graphite);
            font-weight: 700;
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.6rem;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(255,196,0,0.3);
        }

        .btn-secondary {
            padding: 0.9rem 1.8rem;
            border: 1px solid rgba(255,255,255,0.2);
            background: transparent;
            color: white;
            font-weight: 600;
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.6rem;
            font-size: 0.9rem;
        }

        .btn-secondary:hover {
            border-color: var(--taxi-yellow);
            color: var(--taxi-yellow);
        }

        /* LOADING */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(18,18,18,0.98);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            flex-direction: column;
        }

        .loading-overlay.active {
            display: flex;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255,196,0,0.2);
            border-radius: 50%;
            border-top-color: var(--taxi-yellow);
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* TOAST */
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--dark-graphite);
            border-left: 4px solid var(--taxi-yellow);
            padding: 1rem 1.5rem;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.4);
            display: flex;
            align-items: center;
            gap: 0.8rem;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 10000;
            max-width: 350px;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.success {
            border-left-color: var(--available);
        }

        .toast.error {
            border-left-color: var(--busy);
        }

        .toast-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: rgba(255,196,0,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--taxi-yellow);
            font-size: 1rem;
        }

        .toast.success .toast-icon {
            background: rgba(46, 204, 113, 0.1);
            color: var(--available);
        }

        .toast.error .toast-icon {
            background: rgba(231, 76, 60, 0.1);
            color: var(--busy);
        }

        .toast-content h4 {
            font-size: 0.9rem;
            margin-bottom: 0.1rem;
        }

        .toast-content p {
            font-size: 0.8rem;
            color: #aaa;
        }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            .main-content { padding: 1rem; }
            .photo-section { justify-content: center; text-align: center; }
            .profile-info { text-align: center; }
            .form-row { grid-template-columns: 1fr; }
            .form-group.full-width { grid-column: span 1; }
            .photos-grid { grid-template-columns: repeat(3, 1fr); }
            .vehicle-type-selector { flex-direction: column; }
            .form-actions { flex-direction: column; }
            .btn-primary, .btn-secondary { width: 100%; justify-content: center; }
        }

        @media (max-width: 480px) {
            .photos-grid { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>
    <!-- NAVBAR -->
    <nav class="navbar">
        <a href="dashboard-taxi.html" class="btn-back">
            <i class="fas fa-arrow-left"></i>
            <span>Voltar</span>
        </a>
        
        <div style="display: flex; align-items: center; gap: 0.8rem;">
            <div class="user-avatar" id="navAvatar">TX</div>
            <button class="btn-logout" onclick="logout()" title="Sair">
                <i class="fas fa-sign-out-alt"></i>
            </button>
        </div>
    </nav>

    <!-- MAIN CONTENT -->
    <main class="main-content">
        <div class="page-header">
            <h1><i class="fas fa-id-card"></i> Meu Perfil</h1>
        </div>

        <!-- PROFILE CARD -->
        <div class="profile-card">
            <div class="photo-section">
                <div class="photo-upload-container">
                    <div class="profile-placeholder" id="profilePlaceholder">TX</div>
                    <img src="" alt="Foto de perfil" class="profile-photo" id="profilePhoto">
                    <label class="photo-overlay" for="fileInput">
                        <i class="fas fa-camera"></i>
                    </label>
                    <input type="file" id="fileInput" accept="image/*" onchange="handlePhotoUpload(event)">
                </div>
                
                <div class="profile-info">
                    <div class="profile-name" id="displayName">-</div>
                    <div class="profile-email" id="displayEmail">-</div>
                    <div class="profile-status" id="profileStatus">
                        <i class="fas fa-circle"></i> Dispon√≠vel
                    </div>
                </div>
            </div>
        </div>

        <!-- TIPO DE VE√çCULO -->
        <div class="form-section">
            <div class="section-header">
                <i class="fas fa-motorcycle"></i>
                <h2>Tipo de Servi√ßo</h2>
            </div>
            
            <div class="vehicle-type-selector">
                <div class="vehicle-type-card active" id="typeTaxi" onclick="setVehicleType('taxi')">
                    <i class="fas fa-taxi"></i>
                    <span>T√°xi</span>
                </div>
                <div class="vehicle-type-card" id="typeMoto" onclick="setVehicleType('moto')">
                    <i class="fas fa-motorcycle"></i>
                    <span>Moto T√°xi</span>
                </div>
            </div>
        </div>

        <!-- DADOS PESSOAIS -->
        <div class="form-section">
            <div class="section-header">
                <i class="fas fa-user"></i>
                <h2>Dados Pessoais</h2>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label><i class="fas fa-user-tag"></i> Nome Completo <span class="required">*</span></label>
                    <input type="text" id="fullName" placeholder="Digite seu nome completo">
                </div>
                <div class="form-group">
                    <label><i class="fas fa-id-card"></i> CPF <span class="required">*</span></label>
                    <input type="text" id="cpf" placeholder="000.000.000-00" maxlength="14">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label><i class="fas fa-phone-alt"></i> Telefone <span class="required">*</span></label>
                    <input type="tel" id="phone" placeholder="(11) 98765-4321">
                </div>
                <div class="form-group">
                    <label><i class="fas fa-envelope"></i> E-mail</label>
                    <input type="email" id="email" placeholder="seu@email.com" readonly style="background: rgba(255,255,255,0.02);">
                </div>
            </div>

            <div class="form-group full-width">
                <label><i class="fas fa-align-left"></i> Biografia</label>
                <textarea id="bio" placeholder="Fale um pouco sobre voc√™ como motorista..." rows="3"></textarea>
            </div>
        </div>

        <!-- SE√á√ÉO T√ÅXI (INICIAL) -->
        <div id="vehicleTaxiSection">
            <div class="form-section">
                <div class="section-header">
                    <i class="fas fa-taxi"></i>
                    <h2>Dados do T√°xi</h2>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label><i class="fas fa-qrcode"></i> Placa <span class="required">*</span></label>
                        <input type="text" id="plate" placeholder="ABC-1234" maxlength="8">
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-car"></i> Modelo <span class="required">*</span></label>
                        <input type="text" id="carModel" placeholder="Ex: Toyota Corolla">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label><i class="fas fa-calendar"></i> Ano <span class="required">*</span></label>
                        <select id="carYear">
                            <option value="">Selecione</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-palette"></i> Cor <span class="required">*</span></label>
                        <select id="carColor">
                            <option value="">Selecione</option>
                            <option value="Preto">Preto</option>
                            <option value="Branco">Branco</option>
                            <option value="Prata">Prata</option>
                            <option value="Cinza">Cinza</option>
                            <option value="Vermelho">Vermelho</option>
                            <option value="Azul">Azul</option>
                            <option value="Verde">Verde</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label><i class="fas fa-hashtag"></i> N√∫mero do Alvar√°</label>
                        <input type="text" id="alvara" placeholder="Ex: 12345/2025">
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-file-contract"></i> Permiss√£o</label>
                        <input type="text" id="permissao" placeholder="N√∫mero da permiss√£o">
                    </div>
                </div>

                <div class="form-group full-width">
                    <label><i class="fas fa-images"></i> Fotos do Ve√≠culo</label>
                    <div class="photos-grid" id="vehiclePhotos">
                        <div class="photo-upload-box" onclick="document.getElementById('vehiclePhoto0').click()">
                            <i class="fas fa-plus"></i>
                            <span>Frente</span>
                            <input type="file" id="vehiclePhoto0" accept="image/*" style="display: none;" onchange="handleVehiclePhoto(event, 0)">
                        </div>
                        <div class="photo-upload-box" onclick="document.getElementById('vehiclePhoto1').click()">
                            <i class="fas fa-plus"></i>
                            <span>Traseira</span>
                            <input type="file" id="vehiclePhoto1" accept="image/*" style="display: none;" onchange="handleVehiclePhoto(event, 1)">
                        </div>
                        <div class="photo-upload-box" onclick="document.getElementById('vehiclePhoto2').click()">
                            <i class="fas fa-plus"></i>
                            <span>Lateral</span>
                            <input type="file" id="vehiclePhoto2" accept="image/*" style="display: none;" onchange="handleVehiclePhoto(event, 2)">
                        </div>
                        <div class="photo-upload-box" onclick="document.getElementById('vehiclePhoto3').click()">
                            <i class="fas fa-plus"></i>
                            <span>Interior</span>
                            <input type="file" id="vehiclePhoto3" accept="image/*" style="display: none;" onchange="handleVehiclePhoto(event, 3)">
                        </div>
                        <div class="photo-upload-box" onclick="document.getElementById('vehiclePhoto4').click()">
                            <i class="fas fa-plus"></i>
                            <span>Placa</span>
                            <input type="file" id="vehiclePhoto4" accept="image/*" style="display: none;" onchange="handleVehiclePhoto(event, 4)">
                        </div>
                    </div>
                    <p style="color: #666; font-size: 0.75rem; margin-top: 0.5rem;">Envie fotos n√≠tidas de todos os √¢ngulos</p>
                </div>
            </div>
        </div>

        <!-- SE√á√ÉO MOTO (OCULTA INICIALMENTE) -->
        <div id="vehicleMotoSection" style="display: none;">
            <div class="form-section">
                <div class="section-header">
                    <i class="fas fa-motorcycle"></i>
                    <h2>Dados da Moto</h2>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label><i class="fas fa-qrcode"></i> Placa <span class="required">*</span></label>
                        <input type="text" id="motoPlate" placeholder="ABC-1234" maxlength="8">
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-motorcycle"></i> Modelo <span class="required">*</span></label>
                        <input type="text" id="motoModel" placeholder="Ex: Honda CB500X">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label><i class="fas fa-calendar"></i> Ano <span class="required">*</span></label>
                        <select id="motoYear">
                            <option value="">Selecione</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-palette"></i> Cor <span class="required">*</span></label>
                        <select id="motoColor">
                            <option value="">Selecione</option>
                            <option value="Preta">Preta</option>
                            <option value="Branca">Branca</option>
                            <option value="Vermelha">Vermelha</option>
                            <option value="Azul">Azul</option>
                            <option value="Cinza">Cinza</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label><i class="fas fa-hashtag"></i> N√∫mero do Alvar√°</label>
                        <input type="text" id="motoAlvara" placeholder="Ex: 12345/2025">
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-helmet-safety"></i> Capacete Extra</label>
                        <select id="motoCapacete">
                            <option value="">Selecione</option>
                            <option value="sim">Sim, tenho 2 capacetes</option>
                            <option value="nao">N√£o, apenas 1</option>
                        </select>
                    </div>
                </div>

                <div class="form-group full-width">
                    <label><i class="fas fa-images"></i> Fotos da Moto</label>
                    <div class="photos-grid" id="motoPhotos">
                        <div class="photo-upload-box" onclick="document.getElementById('motoPhoto0').click()">
                            <i class="fas fa-plus"></i>
                            <span>Frente</span>
                            <input type="file" id="motoPhoto0" accept="image/*" style="display: none;" onchange="handleMotoPhoto(event, 0)">
                        </div>
                        <div class="photo-upload-box" onclick="document.getElementById('motoPhoto1').click()">
                            <i class="fas fa-plus"></i>
                            <span>Lateral</span>
                            <input type="file" id="motoPhoto1" accept="image/*" style="display: none;" onchange="handleMotoPhoto(event, 1)">
                        </div>
                        <div class="photo-upload-box" onclick="document.getElementById('motoPhoto2').click()">
                            <i class="fas fa-plus"></i>
                            <span>Traseira</span>
                            <input type="file" id="motoPhoto2" accept="image/*" style="display: none;" onchange="handleMotoPhoto(event, 2)">
                        </div>
                        <div class="photo-upload-box" onclick="document.getElementById('motoPhoto3').click()">
                            <i class="fas fa-plus"></i>
                            <span>Placa</span>
                            <input type="file" id="motoPhoto3" accept="image/*" style="display: none;" onchange="handleMotoPhoto(event, 3)">
                        </div>
                        <div class="photo-upload-box" onclick="document.getElementById('motoPhoto4').click()">
                            <i class="fas fa-plus"></i>
                            <span>Capacete</span>
                            <input type="file" id="motoPhoto4" accept="image/*" style="display: none;" onchange="handleMotoPhoto(event, 4)">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- DOCUMENTOS -->
        <div class="form-section">
            <div class="section-header">
                <i class="fas fa-file-alt"></i>
                <h2>Documentos</h2>
            </div>
            
            <div class="form-group full-width" style="margin-bottom: 1rem;">
                <label>CNH <span class="required">*</span></label>
                <div class="document-upload" onclick="document.getElementById('cnhFile').click()">
                    <div class="document-icon">
                        <i class="fas fa-id-card"></i>
                    </div>
                    <div class="document-info">
                        <h4>Carteira Nacional de Habilita√ß√£o</h4>
                        <p id="cnhStatus">Nenhum arquivo enviado</p>
                    </div>
                    <div class="document-status" id="cnhBadge">
                        <i class="fas fa-clock"></i> Pendente
                    </div>
                    <input type="file" id="cnhFile" accept="image/*,.pdf" style="display: none;" onchange="handleDocumentUpload(event, 'cnh')">
                </div>
            </div>

            <div class="form-group full-width" style="margin-bottom: 1rem;">
                <label>CRLV</label>
                <div class="document-upload" onclick="document.getElementById('crlvFile').click()">
                    <div class="document-icon">
                        <i class="fas fa-file-invoice"></i>
                    </div>
                    <div class="document-info">
                        <h4>Certificado de Registro e Licenciamento</h4>
                        <p id="crlvStatus">Nenhum arquivo enviado</p>
                    </div>
                    <div class="document-status" id="crlvBadge">
                        <i class="fas fa-clock"></i> Pendente
                    </div>
                    <input type="file" id="crlvFile" accept="image/*,.pdf" style="display: none;" onchange="handleDocumentUpload(event, 'crlv')">
                </div>
            </div>

            <div class="form-group full-width">
                <label>Comprovante de Resid√™ncia</label>
                <div class="document-upload" onclick="document.getElementById('addressFile').click()">
                    <div class="document-icon">
                        <i class="fas fa-home"></i>
                    </div>
                    <div class="document-info">
                        <h4>Comprovante de Endere√ßo</h4>
                        <p id="addressStatus">Nenhum arquivo enviado</p>
                    </div>
                    <div class="document-status" id="addressBadge">
                        <i class="fas fa-clock"></i> Pendente
                    </div>
                    <input type="file" id="addressFile" accept="image/*,.pdf" style="display: none;" onchange="handleDocumentUpload(event, 'address')">
                </div>
            </div>
        </div>

        <!-- PREFER√äNCIAS -->
        <div class="form-section">
            <div class="section-header">
                <i class="fas fa-cog"></i>
                <h2>Prefer√™ncias</h2>
            </div>
            
            <div class="toggle-group">
                <div class="toggle-info">
                    <h4><i class="fab fa-whatsapp" style="color: #25D366;"></i> Notifica√ß√µes WhatsApp</h4>
                    <p>Receber avisos de novas corridas</p>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" id="notifyWhatsApp">
                    <span class="toggle-slider"></span>
                </label>
            </div>

            <div class="toggle-group" style="margin-top: 1rem;">
                <div class="toggle-info">
                    <h4 style="color: #E74C3C;"><i class="fas fa-power-off"></i> Desativar Conta</h4>
                    <p>N√£o receber novas solicita√ß√µes</p>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" id="deactivateAccount">
                    <span class="toggle-slider" style="background: rgba(231, 76, 60, 0.2);"></span>
                </label>
            </div>
        </div>

        <!-- BOT√ïES -->
        <div class="form-actions">
            <button class="btn-secondary" onclick="resetForm()">
                <i class="fas fa-undo-alt"></i> Limpar
            </button>
            <button class="btn-primary" onclick="saveProfile()" id="saveBtn">
                <i class="fas fa-save"></i> Salvar Perfil
            </button>
        </div>
    </main>

    <!-- TOAST -->
    <div class="toast" id="toast">
        <div class="toast-icon">
            <i class="fas fa-info-circle"></i>
        </div>
        <div class="toast-content">
            <h4 id="toastTitle">Notifica√ß√£o</h4>
            <p id="toastMessage">Mensagem</p>
        </div>
    </div>

    <!-- LOADING -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
        <p style="color: #888;" id="loadingMessage">Enviando imagem...</p>
    </div>

    <script>
        // ==========================================
        // CONFIGURA√á√ÉO CLOUDFLARE R2 (COLE SEUS DADOS AQUI)
        // ==========================================
        const R2_CONFIG = {
            bucketName: 'taxibf-perfil', // Nome do seu bucket
            accessKeyId: 'SUA_ACCESS_KEY_ID', // Cole sua Access Key ID
            secretAccessKey: 'SUA_SECRET_ACCESS_KEY', // Cole sua Secret Access Key
            endpoint: 'https://SEU_ID.r2.cloudflarestorage.com', // Seu endpoint
            publicUrl: 'https://pub-xxxxx.r2.dev' // URL p√∫blica (opicional, mas recomendado)
        };

        // ==========================================
        // CONFIGURA√á√ÉO DO SISTEMA
        // ==========================================
        const USER_DATA_KEY = 'taxibf_motorista_perfil';
        
        // ==========================================
        // VARI√ÅVEIS GLOBAIS
        // ==========================================
        let userData = {
            fullName: '',
            cpf: '',
            phone: '',
            email: '',
            bio: '',
            userType: 'taxi',
            photoURL: null,
            photoKey: null,
            taxi: {
                plate: '',
                model: '',
                year: '',
                color: '',
                alvara: '',
                permissao: '',
                photos: [null, null, null, null, null],
                photoKeys: [null, null, null, null, null]
            },
            moto: {
                plate: '',
                model: '',
                year: '',
                color: '',
                alvara: '',
                capacete: '',
                photos: [null, null, null, null, null],
                photoKeys: [null, null, null, null, null]
            },
            documents: {},
            preferences: {
                notifyWhatsApp: true
            },
            status: 'available',
            createdAt: new Date().toISOString(),
            updatedAt: new Date().toISOString()
        };

        // Arrays de fotos
        let taxiPhotos = [null, null, null, null, null];
        let taxiPhotoKeys = [null, null, null, null, null];
        let motoPhotos = [null, null, null, null, null];
        let motoPhotoKeys = [null, null, null, null, null];

        // ==========================================
        // INICIALIZAR AWS SDK PARA CLOUDFLARE R2
        // ==========================================
        function initR2Client() {
            AWS.config.update({
                accessKeyId: R2_CONFIG.accessKeyId,
                secretAccessKey: R2_CONFIG.secretAccessKey,
                region: 'auto',
                signatureVersion: 'v4'
            });

            return new AWS.S3({
                endpoint: R2_CONFIG.endpoint,
                s3ForcePathStyle: true,
                signatureVersion: 'v4'
            });
        }

        // ==========================================
        // UPLOAD PARA CLOUDFLARE R2
        // ==========================================
        async function uploadToR2(file, folder = 'perfil') {
            if (!R2_CONFIG.accessKeyId || R2_CONFIG.accessKeyId === 'SUA_ACCESS_KEY_ID') {
                throw new Error('Configure suas credenciais do Cloudflare R2 no in√≠cio do script');
            }

            const s3 = initR2Client();
            
            // Gerar nome √∫nico do arquivo
            const timestamp = Date.now();
            const random = Math.floor(Math.random() * 10000);
            const extension = file.name.split('.').pop();
            const fileName = `${folder}/${timestamp}_${random}.${extension}`;
            
            // Configurar upload
            const params = {
                Bucket: R2_CONFIG.bucketName,
                Key: fileName,
                Body: file,
                ContentType: file.type,
                CacheControl: 'public, max-age=31536000'
            };

            try {
                console.log('üì§ Enviando para Cloudflare R2...', fileName);
                
                // Fazer upload
                const result = await s3.upload(params).promise();
                
                // URL p√∫blica (se configurada)
                let publicUrl = result.Location;
                if (R2_CONFIG.publicUrl) {
                    publicUrl = `${R2_CONFIG.publicUrl}/${fileName}`;
                }
                
                console.log('‚úÖ Upload conclu√≠do:', publicUrl);
                
                return {
                    url: publicUrl,
                    key: fileName,
                    location: result.Location
                };
                
            } catch (error) {
                console.error('‚ùå Erro no upload R2:', error);
                throw error;
            }
        }

        // ==========================================
        // DELETAR ARQUIVO DO R2
        // ==========================================
        async function deleteFromR2(key) {
            if (!key) return;
            
            try {
                const s3 = initR2Client();
                
                const params = {
                    Bucket: R2_CONFIG.bucketName,
                    Key: key
                };
                
                await s3.deleteObject(params).promise();
                console.log('üóëÔ∏è Arquivo deletado:', key);
                
            } catch (error) {
                console.error('‚ùå Erro ao deletar:', error);
            }
        }

        // ==========================================
        // UPLOAD DE FOTO DE PERFIL
        // ==========================================
        async function handlePhotoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            // Valida√ß√µes
            if (!file.type.startsWith('image/')) {
                showToast('Erro', 'Selecione uma imagem v√°lida', 'error');
                return;
            }

            if (file.size > 5 * 1024 * 1024) {
                showToast('Erro', 'A imagem deve ter no m√°ximo 5MB', 'error');
                return;
            }

            showLoading(true, 'Enviando foto de perfil...');

            try {
                // Upload para R2
                const result = await uploadToR2(file, 'perfil');
                
                // Deletar foto antiga se existir
                if (userData.photoKey) {
                    await deleteFromR2(userData.photoKey);
                }

                // Atualizar dados
                userData.photoURL = result.url;
                userData.photoKey = result.key;
                saveToLocalStorage();

                // Atualizar UI
                displayProfilePhoto(result.url);
                showToast('Sucesso', 'Foto de perfil atualizada', 'success');
                
            } catch (error) {
                console.error(error);
                showToast('Erro', error.message || 'Falha ao enviar imagem', 'error');
            } finally {
                showLoading(false);
                event.target.value = '';
            }
        }

        function displayProfilePhoto(url) {
            const photo = document.getElementById('profilePhoto');
            const placeholder = document.getElementById('profilePlaceholder');
            
            if (photo && url) {
                photo.src = url;
                photo.style.display = 'block';
                placeholder.style.display = 'none';
            }
        }

        // ==========================================
        // UPLOAD DE FOTOS DO T√ÅXI
        // ==========================================
        async function handleVehiclePhoto(event, index) {
            const file = event.target.files[0];
            if (!file) return;

            if (!file.type.startsWith('image/')) {
                showToast('Erro', 'Selecione uma imagem', 'error');
                return;
            }

            showLoading(true, 'Enviando foto do ve√≠culo...');

            try {
                // Upload para R2
                const result = await uploadToR2(file, `taxi/${userData.fullName || 'veiculo'}`);
                
                // Deletar foto antiga
                if (taxiPhotoKeys[index]) {
                    await deleteFromR2(taxiPhotoKeys[index]);
                }

                // Atualizar arrays
                taxiPhotos[index] = result.url;
                taxiPhotoKeys[index] = result.key;
                
                // Atualizar userData
                userData.taxi.photos = taxiPhotos;
                userData.taxi.photoKeys = taxiPhotoKeys;
                saveToLocalStorage();

                // Atualizar UI
                displayVehiclePhoto(result.url, index);
                showToast('Sucesso', 'Foto adicionada', 'success');
                
            } catch (error) {
                showToast('Erro', error.message, 'error');
            } finally {
                showLoading(false);
                event.target.value = '';
            }
        }

        function displayVehiclePhoto(url, index) {
            const boxes = document.querySelectorAll('#vehiclePhotos .photo-upload-box');
            if (!boxes[index]) return;
            
            const box = boxes[index];
            const labels = ['Frente', 'Traseira', 'Lateral', 'Interior', 'Placa'];
            
            box.innerHTML = `
                <img src="${url}" alt="Foto ${labels[index]}">
                <button class="photo-remove" onclick="removeVehiclePhoto(event, ${index})">
                    <i class="fas fa-times"></i>
                </button>
            `;
            box.classList.add('has-image');
        }

        async function removeVehiclePhoto(event, index) {
            event.stopPropagation();
            
            if (!confirm('Remover esta foto?')) return;
            
            showLoading(true, 'Removendo foto...');
            
            try {
                // Deletar do R2
                if (taxiPhotoKeys[index]) {
                    await deleteFromR2(taxiPhotoKeys[index]);
                }
                
                // Limpar arrays
                taxiPhotos[index] = null;
                taxiPhotoKeys[index] = null;
                
                // Atualizar userData
                userData.taxi.photos = taxiPhotos;
                userData.taxi.photoKeys = taxiPhotoKeys;
                saveToLocalStorage();
                
                // Resetar UI
                const boxes = document.querySelectorAll('#vehiclePhotos .photo-upload-box');
                const box = boxes[index];
                const labels = ['Frente', 'Traseira', 'Lateral', 'Interior', 'Placa'];
                
                box.innerHTML = `
                    <i class="fas fa-plus"></i>
                    <span>${labels[index]}</span>
                    <input type="file" id="vehiclePhoto${index}" accept="image/*" style="display: none;" onchange="handleVehiclePhoto(event, ${index})">
                `;
                box.classList.remove('has-image');
                
                showToast('Sucesso', 'Foto removida', 'success');
                
            } catch (error) {
                showToast('Erro', error.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        // ==========================================
        // UPLOAD DE FOTOS DA MOTO
        // ==========================================
        async function handleMotoPhoto(event, index) {
            const file = event.target.files[0];
            if (!file) return;

            showLoading(true, 'Enviando foto da moto...');

            try {
                const result = await uploadToR2(file, `moto/${userData.fullName || 'veiculo'}`);
                
                if (motoPhotoKeys[index]) {
                    await deleteFromR2(motoPhotoKeys[index]);
                }

                motoPhotos[index] = result.url;
                motoPhotoKeys[index] = result.key;
                
                userData.moto.photos = motoPhotos;
                userData.moto.photoKeys = motoPhotoKeys;
                saveToLocalStorage();

                displayMotoPhoto(result.url, index);
                showToast('Sucesso', 'Foto adicionada', 'success');
                
            } catch (error) {
                showToast('Erro', error.message, 'error');
            } finally {
                showLoading(false);
                event.target.value = '';
            }
        }

        function displayMotoPhoto(url, index) {
            const boxes = document.querySelectorAll('#motoPhotos .photo-upload-box');
            if (!boxes[index]) return;
            
            const box = boxes[index];
            const labels = ['Frente', 'Lateral', 'Traseira', 'Placa', 'Capacete'];
            
            box.innerHTML = `
                <img src="${url}" alt="Foto ${labels[index]}">
                <button class="photo-remove" onclick="removeMotoPhoto(event, ${index})">
                    <i class="fas fa-times"></i>
                </button>
            `;
            box.classList.add('has-image');
        }

        async function removeMotoPhoto(event, index) {
            event.stopPropagation();
            if (!confirm('Remover esta foto?')) return;
            
            showLoading(true, 'Removendo foto...');
            
            try {
                if (motoPhotoKeys[index]) {
                    await deleteFromR2(motoPhotoKeys[index]);
                }
                
                motoPhotos[index] = null;
                motoPhotoKeys[index] = null;
                
                userData.moto.photos = motoPhotos;
                userData.moto.photoKeys = motoPhotoKeys;
                saveToLocalStorage();
                
                const boxes = document.querySelectorAll('#motoPhotos .photo-upload-box');
                const box = boxes[index];
                const labels = ['Frente', 'Lateral', 'Traseira', 'Placa', 'Capacete'];
                
                box.innerHTML = `
                    <i class="fas fa-plus"></i>
                    <span>${labels[index]}</span>
                    <input type="file" id="motoPhoto${index}" accept="image/*" style="display: none;" onchange="handleMotoPhoto(event, ${index})">
                `;
                box.classList.remove('has-image');
                
                showToast('Sucesso', 'Foto removida', 'success');
                
            } catch (error) {
                showToast('Erro', error.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        // ==========================================
        // UPLOAD DE DOCUMENTOS
        // ==========================================
        async function handleDocumentUpload(event, type) {
            const file = event.target.files[0];
            if (!file) return;

            if (file.size > 10 * 1024 * 1024) {
                showToast('Erro', 'Arquivo muito grande. M√°ximo 10MB', 'error');
                return;
            }

            showLoading(true, 'Enviando documento...');

            try {
                let result;
                
                if (file.type.startsWith('image/')) {
                    result = await uploadToR2(file, `documentos/${type}`);
                } else {
                    // Para PDFs, tamb√©m enviar para R2
                    result = await uploadToR2(file, `documentos/${type}`);
                }

                const docData = {
                    url: result.url,
                    key: result.key,
                    name: file.name,
                    type: file.type,
                    size: file.size,
                    uploadedAt: new Date().toISOString(),
                    status: 'pending'
                };

                userData.documents[type] = docData;
                saveToLocalStorage();

                // Atualizar UI
                const statusEl = document.getElementById(`${type}Status`);
                const badgeEl = document.getElementById(`${type}Badge`);
                
                if (statusEl) {
                    statusEl.textContent = file.name.length > 40 ? file.name.substring(0, 40) + '...' : file.name;
                }
                if (badgeEl) {
                    badgeEl.innerHTML = '<i class="fas fa-clock"></i> Aguardando';
                }

                showToast('Sucesso', 'Documento enviado', 'success');
                
            } catch (error) {
                showToast('Erro', error.message, 'error');
            } finally {
                showLoading(false);
                event.target.value = '';
            }
        }

        // ==========================================
        // TIPO DE VE√çCULO
        // ==========================================
        function setVehicleType(type) {
            userData.userType = type;
            saveToLocalStorage();
            
            const taxiCard = document.getElementById('typeTaxi');
            const motoCard = document.getElementById('typeMoto');
            const taxiSection = document.getElementById('vehicleTaxiSection');
            const motoSection = document.getElementById('vehicleMotoSection');
            
            if (type === 'taxi') {
                taxiCard.classList.add('active');
                motoCard.classList.remove('active');
                taxiSection.style.display = 'block';
                motoSection.style.display = 'none';
            } else {
                motoCard.classList.add('active');
                taxiCard.classList.remove('active');
                motoSection.style.display = 'block';
                taxiSection.style.display = 'none';
            }
        }

        // ==========================================
        // LOCALSTORAGE
        // ==========================================
        function saveToLocalStorage() {
            try {
                userData.updatedAt = new Date().toISOString();
                localStorage.setItem(USER_DATA_KEY, JSON.stringify(userData));
                console.log('‚úÖ Dados salvos no localStorage');
                return true;
            } catch (e) {
                console.error('‚ùå Erro ao salvar localStorage:', e);
                return false;
            }
        }

        function loadFromLocalStorage() {
            try {
                const saved = localStorage.getItem(USER_DATA_KEY);
                if (saved) {
                    const data = JSON.parse(saved);
                    userData = { ...userData, ...data };
                    
                    // Restaurar arrays
                    if (userData.taxi?.photos) taxiPhotos = [...userData.taxi.photos];
                    if (userData.taxi?.photoKeys) taxiPhotoKeys = [...userData.taxi.photoKeys];
                    if (userData.moto?.photos) motoPhotos = [...userData.moto.photos];
                    if (userData.moto?.photoKeys) motoPhotoKeys = [...userData.moto.photoKeys];
                    
                    console.log('‚úÖ Dados carregados do localStorage');
                    return true;
                }
            } catch (e) {
                console.error('‚ùå Erro ao carregar localStorage:', e);
            }
            return false;
        }

        // ==========================================
        // PREENCHER FORMUL√ÅRIO
        // ==========================================
        function fillForm() {
            // Dados pessoais
            setValue('fullName', userData.fullName);
            setValue('cpf', userData.cpf);
            setValue('phone', userData.phone);
            setValue('email', userData.email || '');
            setValue('bio', userData.bio || '');
            
            // T√°xi
            setValue('plate', userData.taxi?.plate || '');
            setValue('carModel', userData.taxi?.model || '');
            setValue('carYear', userData.taxi?.year || '');
            setValue('carColor', userData.taxi?.color || '');
            setValue('alvara', userData.taxi?.alvara || '');
            setValue('permissao', userData.taxi?.permissao || '');
            
            // Moto
            setValue('motoPlate', userData.moto?.plate || '');
            setValue('motoModel', userData.moto?.model || '');
            setValue('motoYear', userData.moto?.year || '');
            setValue('motoColor', userData.moto?.color || '');
            setValue('motoAlvara', userData.moto?.alvara || '');
            setValue('motoCapacete', userData.moto?.capacete || '');
            
            // Prefer√™ncias
            setCheckbox('notifyWhatsApp', userData.preferences?.notifyWhatsApp !== false);
            setCheckbox('deactivateAccount', userData.status === 'inactive');
            
            // Perfil
            updateProfileDisplay();
            
            // Foto de perfil
            if (userData.photoURL) {
                displayProfilePhoto(userData.photoURL);
            }
            
            // Fotos do t√°xi
            if (userData.taxi?.photos) {
                userData.taxi.photos.forEach((url, index) => {
                    if (url) displayVehiclePhoto(url, index);
                });
            }
            
            // Fotos da moto
            if (userData.moto?.photos) {
                userData.moto.photos.forEach((url, index) => {
                    if (url) displayMotoPhoto(url, index);
                });
            }
            
            // Documentos
            if (userData.documents) {
                if (userData.documents.cnh) {
                    document.getElementById('cnhStatus').textContent = userData.documents.cnh.name.substring(0, 40) + '...';
                }
                if (userData.documents.crlv) {
                    document.getElementById('crlvStatus').textContent = userData.documents.crlv.name.substring(0, 40) + '...';
                }
                if (userData.documents.address) {
                    document.getElementById('addressStatus').textContent = userData.documents.address.name.substring(0, 40) + '...';
                }
            }
            
            // Tipo de ve√≠culo
            setVehicleType(userData.userType || 'taxi');
        }

        function setValue(id, value) {
            const el = document.getElementById(id);
            if (el) el.value = value || '';
        }

        function setCheckbox(id, checked) {
            const el = document.getElementById(id);
            if (el) el.checked = checked || false;
        }

        function getValue(id) {
            const el = document.getElementById(id);
            return el ? el.value.trim() : '';
        }

        function updateProfileDisplay() {
            const name = userData.fullName || 'Motorista';
            const email = userData.email || 'N√£o informado';
            const initials = name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase() || 'TX';
            
            setText('displayName', name);
            setText('displayEmail', email);
            setText('navAvatar', initials);
            
            // Placeholder tamb√©m recebe as iniciais
            const placeholder = document.getElementById('profilePlaceholder');
            if (placeholder && !userData.photoURL) {
                placeholder.textContent = initials;
            }
            
            // Status
            const statusEl = document.getElementById('profileStatus');
            if (statusEl) {
                if (userData.status === 'inactive') {
                    statusEl.className = 'profile-status inactive';
                    statusEl.innerHTML = '<i class="fas fa-circle"></i> Inativo';
                } else {
                    statusEl.className = 'profile-status';
                    statusEl.innerHTML = '<i class="fas fa-circle"></i> Dispon√≠vel';
                }
            }
        }

        function setText(id, text) {
            const el = document.getElementById(id);
            if (el) el.textContent = text;
        }

        // ==========================================
        // SALVAR PERFIL
        // ==========================================
        function saveProfile() {
            if (!validateForm()) return;

            // Dados pessoais
            userData.fullName = getValue('fullName');
            userData.cpf = getValue('cpf');
            userData.phone = getValue('phone');
            userData.email = getValue('email');
            userData.bio = getValue('bio');
            
            // Dados do t√°xi
            if (userData.userType === 'taxi') {
                userData.taxi = userData.taxi || {};
                userData.taxi.plate = getValue('plate').toUpperCase();
                userData.taxi.model = getValue('carModel');
                userData.taxi.year = getValue('carYear');
                userData.taxi.color = getValue('carColor');
                userData.taxi.alvara = getValue('alvara');
                userData.taxi.permissao = getValue('permissao');
                userData.taxi.photos = taxiPhotos;
                userData.taxi.photoKeys = taxiPhotoKeys;
            } else {
                userData.moto = userData.moto || {};
                userData.moto.plate = getValue('motoPlate').toUpperCase();
                userData.moto.model = getValue('motoModel');
                userData.moto.year = getValue('motoYear');
                userData.moto.color = getValue('motoColor');
                userData.moto.alvara = getValue('motoAlvara');
                userData.moto.capacete = getValue('motoCapacete');
                userData.moto.photos = motoPhotos;
                userData.moto.photoKeys = motoPhotoKeys;
            }
            
            // Prefer√™ncias
            userData.preferences = userData.preferences || {};
            userData.preferences.notifyWhatsApp = document.getElementById('notifyWhatsApp')?.checked || false;
            
            // Status
            userData.status = document.getElementById('deactivateAccount')?.checked ? 'inactive' : 'available';
            
            // Salvar
            saveToLocalStorage();
            updateProfileDisplay();
            
            showToast('Sucesso', 'Perfil salvo com sucesso', 'success');
        }

        // ==========================================
        // VALIDA√á√ÉO
        // ==========================================
        function validateForm() {
            let valid = true;
            
            // Campos obrigat√≥rios
            const required = ['fullName', 'cpf', 'phone'];
            
            if (userData.userType === 'taxi') {
                required.push('plate', 'carModel', 'carYear', 'carColor');
            } else {
                required.push('motoPlate', 'motoModel', 'motoYear', 'motoColor');
            }
            
            required.forEach(id => {
                const el = document.getElementById(id);
                if (el && !el.value.trim()) {
                    el.classList.add('error');
                    valid = false;
                } else if (el) {
                    el.classList.remove('error');
                }
            });
            
            if (!valid) {
                showToast('Aten√ß√£o', 'Preencha todos os campos obrigat√≥rios', 'error');
            }
            
            return valid;
        }

        // ==========================================
        // RESET FORM
        // ==========================================
        function resetForm() {
            if (confirm('Limpar todas as altera√ß√µes n√£o salvas?')) {
                loadFromLocalStorage();
                fillForm();
                showToast('Info', 'Formul√°rio restaurado', 'info');
            }
        }

        // ==========================================
        // POPULAR ANOS
        // ==========================================
        function populateYears() {
            const currentYear = new Date().getFullYear();
            
            ['carYear', 'motoYear'].forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    select.innerHTML = '<option value="">Selecione o ano</option>';
                    for (let year = currentYear; year >= 2000; year--) {
                        const option = document.createElement('option');
                        option.value = year;
                        option.textContent = year;
                        select.appendChild(option);
                    }
                }
            });
        }

        // ==========================================
        // M√ÅSCARAS
        // ==========================================
        function maskCPF(e) {
            let v = e.target.value.replace(/\D/g, '').substring(0, 11);
            v = v.replace(/(\d{3})(\d)/, '$1.$2');
            v = v.replace(/(\d{3})(\d)/, '$1.$2');
            v = v.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
            e.target.value = v;
        }

        function maskPhone(e) {
            let v = e.target.value.replace(/\D/g, '').substring(0, 11);
            if (v.length === 11) {
                v = v.replace(/^(\d{2})(\d{5})(\d{4})$/, '($1) $2-$3');
            } else if (v.length === 10) {
                v = v.replace(/^(\d{2})(\d{4})(\d{4})$/, '($1) $2-$3');
            } else if (v.length > 2) {
                v = v.replace(/^(\d{2})(\d)/, '($1) $2');
            }
            e.target.value = v;
        }

        function maskPlate(e) {
            let v = e.target.value.toUpperCase().replace(/[^A-Z0-9]/g, '').substring(0, 7);
            if (v.length === 7) {
                if (/^[A-Z]{3}[0-9][A-Z][0-9]{2}$/.test(v)) {
                    v = v.replace(/^([A-Z]{3})([0-9])([A-Z])([0-9]{2})$/, '$1$2$3$4');
                } else {
                    v = v.replace(/^([A-Z]{3})(\d{4})$/, '$1-$2');
                }
            } else if (v.length > 3) {
                v = v.replace(/^([A-Z]{3})(.+)$/, '$1-$2');
            }
            e.target.value = v;
        }

        // ==========================================
        // TOAST
        // ==========================================
        function showToast(title, message, type = 'info') {
            const toast = document.getElementById('toast');
            const icon = toast.querySelector('.toast-icon i');
            const titleEl = document.getElementById('toastTitle');
            const msgEl = document.getElementById('toastMessage');
            
            titleEl.textContent = title;
            msgEl.textContent = message;
            
            toast.className = 'toast show';
            toast.classList.add(type);
            
            if (type === 'success') icon.className = 'fas fa-check-circle';
            else if (type === 'error') icon.className = 'fas fa-exclamation-circle';
            else icon.className = 'fas fa-info-circle';
            
            setTimeout(() => toast.classList.remove('show'), 3500);
        }

        // ==========================================
        // LOADING
        // ==========================================
        function showLoading(show, message = 'Processando...') {
            const overlay = document.getElementById('loadingOverlay');
            const msgEl = document.getElementById('loadingMessage');
            
            if (overlay) {
                if (show) {
                    if (msgEl) msgEl.textContent = message;
                    overlay.classList.add('active');
                } else {
                    overlay.classList.remove('active');
                }
            }
        }

        // ==========================================
        // LOGOUT
        // ==========================================
        function logout() {
            if (confirm('Deseja sair da sua conta?')) {
                window.location.href = 'login.html';
            }
        }

        // ==========================================
        // VERIFICAR CREDENCIAIS R2
        // ==========================================
        function checkR2Credentials() {
            if (!R2_CONFIG.accessKeyId || R2_CONFIG.accessKeyId === 'SUA_ACCESS_KEY_ID') {
                showToast('Aviso', 'Configure suas credenciais do Cloudflare R2 para fazer upload', 'warning');
                console.warn('‚ö†Ô∏è Cloudflare R2 n√£o configurado');
                return false;
            }
            return true;
        }

        // ==========================================
        // INIT
        // ==========================================
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ TaxiBF - Perfil do Motorista');
            console.log('‚òÅÔ∏è Storage: Cloudflare R2');
            
            // Verificar configura√ß√£o
            checkR2Credentials();
            
            // Popular anos
            populateYears();
            
            // Carregar dados salvos
            loadFromLocalStorage();
            fillForm();
            
            // M√°scaras
            document.getElementById('cpf')?.addEventListener('input', maskCPF);
            document.getElementById('phone')?.addEventListener('input', maskPhone);
            document.getElementById('plate')?.addEventListener('input', maskPlate);
            document.getElementById('motoPlate')?.addEventListener('input', maskPlate);
            
            // Status checkbox
            const deactivateCheck = document.getElementById('deactivateAccount');
            if (deactivateCheck) {
                deactivateCheck.addEventListener('change', function() {
                    userData.status = this.checked ? 'inactive' : 'available';
                    updateProfileDisplay();
                });
            }
        });

        // ==========================================
        // EXPORTAR FUN√á√ïES
        // ==========================================
        window.handlePhotoUpload = handlePhotoUpload;
        window.handleVehiclePhoto = handleVehiclePhoto;
        window.removeVehiclePhoto = removeVehiclePhoto;
        window.handleMotoPhoto = handleMotoPhoto;
        window.removeMotoPhoto = removeMotoPhoto;
        window.handleDocumentUpload = handleDocumentUpload;
        window.setVehicleType = setVehicleType;
        window.saveProfile = saveProfile;
        window.resetForm = resetForm;
        window.logout = logout;
    </script>
</body>
</html>