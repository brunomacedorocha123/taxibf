<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TaxiBF - Perfil do Motorista</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --taxi-yellow: #FFC400;
            --dark-graphite: #1C1C1C;
            --darker: #121212;
            --white: #FFFFFF;
            --gray: #2A2A2A;
            --available: #2ECC71;
            --busy: #E74C3C;
            --warning: #F39C12;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--darker);
            color: var(--white);
            line-height: 1.5;
        }

        .navbar {
            background: var(--dark-graphite);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            padding: 0.8rem 1.5rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .btn-back {
            background: none;
            border: none;
            color: var(--white);
            cursor: pointer;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
            text-decoration: none;
        }

        .btn-back:hover {
            color: var(--taxi-yellow);
        }

        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--taxi-yellow), #FFD700);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: var(--dark-graphite);
            border: 2px solid var(--dark-graphite);
        }

        .btn-logout {
            background: none;
            border: none;
            color: #888;
            cursor: pointer;
            font-size: 1.2rem;
            padding: 0.5rem;
        }

        .btn-logout:hover {
            color: var(--busy);
        }

        .main-content {
            margin-top: 80px;
            padding: 2rem 1.5rem;
            max-width: 1000px;
            margin-left: auto;
            margin-right: auto;
        }

        .page-header {
            margin-bottom: 2rem;
        }

        .page-header h1 {
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 0.8rem;
            color: white;
        }

        .page-header h1 i {
            color: var(--taxi-yellow);
        }

        .profile-card {
            background: var(--dark-graphite);
            border-radius: 24px;
            padding: 2rem;
            border: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 2rem;
        }

        .photo-section {
            display: flex;
            align-items: center;
            gap: 2rem;
            flex-wrap: wrap;
        }

        .photo-upload-container {
            position: relative;
            width: 130px;
            height: 130px;
        }

        .profile-photo {
            width: 130px;
            height: 130px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid var(--taxi-yellow);
            display: none;
        }

        .profile-placeholder {
            width: 130px;
            height: 130px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--taxi-yellow), #FFD700);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--dark-graphite);
            border: 4px solid var(--taxi-yellow);
        }

        .photo-overlay {
            position: absolute;
            bottom: 5px;
            right: 5px;
            width: 38px;
            height: 38px;
            background: var(--taxi-yellow);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: 3px solid var(--dark-graphite);
            transition: transform 0.2s;
        }

        .photo-overlay:hover {
            transform: scale(1.1);
        }

        .photo-overlay i {
            color: var(--dark-graphite);
            font-size: 1rem;
        }

        #fileInput {
            display: none;
        }

        .profile-info {
            flex: 1;
        }

        .profile-name {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 0.3rem;
            color: white;
        }

        .profile-email {
            color: #888;
            margin-bottom: 0.8rem;
            font-size: 0.95rem;
        }

        .profile-status {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(46, 204, 113, 0.2);
            color: var(--available);
            padding: 0.5rem 1.2rem;
            border-radius: 30px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .profile-status.inactive {
            background: rgba(231, 76, 60, 0.2);
            color: var(--busy);
        }

        .form-section {
            background: var(--dark-graphite);
            border-radius: 24px;
            padding: 1.8rem;
            border: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 1.8rem;
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            margin-bottom: 1.5rem;
            padding-bottom: 0.8rem;
            border-bottom: 2px solid rgba(255,255,255,0.05);
        }

        .section-header i {
            color: var(--taxi-yellow);
            font-size: 1.2rem;
        }

        .section-header h2 {
            font-size: 1.2rem;
            font-weight: 700;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.2rem;
            margin-bottom: 1.2rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.4rem;
        }

        .form-group.full-width {
            grid-column: span 2;
        }

        label {
            font-size: 0.85rem;
            font-weight: 600;
            color: #aaa;
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        label i {
            color: var(--taxi-yellow);
            font-size: 0.85rem;
        }

        .required {
            color: var(--busy);
            margin-left: 0.2rem;
        }

        input, select, textarea {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 0.8rem 1rem;
            color: white;
            font-family: 'Inter', sans-serif;
            font-size: 0.95rem;
            transition: all 0.2s;
            width: 100%;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--taxi-yellow);
            background: rgba(255,255,255,0.08);
        }

        input::placeholder {
            color: #666;
        }

        input.error {
            border-color: var(--busy);
        }

        input[readonly] {
            background: rgba(255,255,255,0.02);
            color: #aaa;
            cursor: not-allowed;
        }

        .vehicle-type-selector {
            display: flex;
            gap: 1rem;
            margin-bottom: 0.5rem;
        }

        .vehicle-type-card {
            flex: 1;
            background: rgba(255,255,255,0.03);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 16px;
            padding: 1.2rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.6rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .vehicle-type-card i {
            font-size: 2rem;
            color: #888;
        }

        .vehicle-type-card span {
            font-weight: 600;
        }

        .vehicle-type-card.active {
            background: rgba(255,196,0,0.1);
            border-color: var(--taxi-yellow);
        }

        .vehicle-type-card.active i {
            color: var(--taxi-yellow);
        }

        .photos-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 0.8rem;
            margin-top: 0.8rem;
        }

        .photo-upload-box {
            aspect-ratio: 1/1;
            background: rgba(255,255,255,0.03);
            border: 2px dashed rgba(255,255,255,0.15);
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }

        .photo-upload-box:hover {
            border-color: var(--taxi-yellow);
            background: rgba(255,196,0,0.05);
        }

        .photo-upload-box.has-image {
            border-style: solid;
            border-color: var(--taxi-yellow);
        }

        .photo-upload-box img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            position: absolute;
            top: 0;
            left: 0;
        }

        .photo-upload-box i {
            font-size: 1.3rem;
            color: #666;
            margin-bottom: 0.2rem;
        }

        .photo-upload-box span {
            font-size: 0.65rem;
            color: #888;
            text-align: center;
            padding: 0 0.2rem;
        }

        .photo-remove {
            position: absolute;
            top: 4px;
            right: 4px;
            width: 26px;
            height: 26px;
            background: var(--busy);
            border: none;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            font-size: 0.8rem;
        }

        .photo-remove:hover {
            transform: scale(1.1);
        }

        .document-upload {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: rgba(255,255,255,0.03);
            border-radius: 12px;
            border: 2px dashed rgba(255,255,255,0.15);
            cursor: pointer;
            transition: all 0.2s;
        }

        .document-upload:hover {
            border-color: var(--taxi-yellow);
            background: rgba(255,196,0,0.05);
        }

        .document-icon {
            width: 45px;
            height: 45px;
            background: rgba(255,196,0,0.1);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--taxi-yellow);
            font-size: 1.3rem;
        }

        .document-info {
            flex: 1;
        }

        .document-info h4 {
            font-size: 0.95rem;
            margin-bottom: 0.2rem;
        }

        .document-info p {
            font-size: 0.75rem;
            color: #888;
        }

        .document-status {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            font-size: 0.75rem;
            font-weight: 600;
            padding: 0.3rem 0.8rem;
            border-radius: 30px;
            background: rgba(243, 156, 18, 0.1);
            color: var(--warning);
        }

        .document-status.verified {
            background: rgba(46, 204, 113, 0.1);
            color: var(--available);
        }

        .toggle-group {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
            background: rgba(255,255,255,0.03);
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.05);
        }

        .toggle-info h4 {
            font-size: 0.95rem;
            margin-bottom: 0.2rem;
        }

        .toggle-info p {
            font-size: 0.75rem;
            color: #888;
        }

        .toggle-switch {
            position: relative;
            width: 52px;
            height: 28px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255,255,255,0.1);
            transition: 0.2s;
            border-radius: 34px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 3px;
            bottom: 3px;
            background: white;
            transition: 0.2s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background: var(--taxi-yellow);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(24px);
            background: var(--dark-graphite);
        }

        .form-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 1.5rem;
        }

        .btn-primary {
            padding: 0.9rem 2rem;
            border: none;
            background: var(--taxi-yellow);
            color: var(--dark-graphite);
            font-weight: 700;
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.6rem;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(255,196,0,0.3);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-secondary {
            padding: 0.9rem 1.8rem;
            border: 1px solid rgba(255,255,255,0.2);
            background: transparent;
            color: white;
            font-weight: 600;
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.6rem;
            font-size: 0.9rem;
        }

        .btn-secondary:hover {
            border-color: var(--taxi-yellow);
            color: var(--taxi-yellow);
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(18,18,18,0.98);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            flex-direction: column;
        }

        .loading-overlay.active {
            display: flex;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255,196,0,0.2);
            border-radius: 50%;
            border-top-color: var(--taxi-yellow);
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--dark-graphite);
            border-left: 4px solid var(--taxi-yellow);
            padding: 1rem 1.5rem;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.4);
            display: flex;
            align-items: center;
            gap: 0.8rem;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 10000;
            max-width: 350px;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.success {
            border-left-color: var(--available);
        }

        .toast.error {
            border-left-color: var(--busy);
        }

        .toast.warning {
            border-left-color: var(--warning);
        }

        .toast-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: rgba(255,196,0,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--taxi-yellow);
            font-size: 1rem;
        }

        .toast.success .toast-icon {
            background: rgba(46, 204, 113, 0.1);
            color: var(--available);
        }

        .toast.error .toast-icon {
            background: rgba(231, 76, 60, 0.1);
            color: var(--busy);
        }

        .toast.warning .toast-icon {
            background: rgba(243, 156, 18, 0.1);
            color: var(--warning);
        }

        .toast-content h4 {
            font-size: 0.9rem;
            margin-bottom: 0.1rem;
        }

        .toast-content p {
            font-size: 0.8rem;
            color: #aaa;
        }

        @media (max-width: 768px) {
            .main-content { padding: 1rem; }
            .photo-section { justify-content: center; text-align: center; }
            .profile-info { text-align: center; }
            .form-row { grid-template-columns: 1fr; }
            .form-group.full-width { grid-column: span 1; }
            .photos-grid { grid-template-columns: repeat(3, 1fr); }
            .vehicle-type-selector { flex-direction: column; }
            .form-actions { flex-direction: column; }
            .btn-primary, .btn-secondary { width: 100%; justify-content: center; }
            .toast { left: 20px; right: 20px; max-width: none; }
        }

        @media (max-width: 480px) {
            .photos-grid { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>
    <!-- NAVBAR -->
    <nav class="navbar">
        <a href="dashboard-taxi.html" class="btn-back">
            <i class="fas fa-arrow-left"></i>
            <span>Voltar</span>
        </a>
        
        <div style="display: flex; align-items: center; gap: 0.8rem;">
            <div class="user-avatar" id="navAvatar">TX</div>
            <button class="btn-logout" id="btnLogout" title="Sair">
                <i class="fas fa-sign-out-alt"></i>
            </button>
        </div>
    </nav>

    <!-- MAIN CONTENT -->
    <main class="main-content">
        <div class="page-header">
            <h1><i class="fas fa-id-card"></i> Meu Perfil</h1>
        </div>

        <!-- PROFILE CARD -->
        <div class="profile-card">
            <div class="photo-section">
                <div class="photo-upload-container">
                    <div class="profile-placeholder" id="profilePlaceholder">TX</div>
                    <img src="" alt="Foto de perfil" class="profile-photo" id="profilePhoto">
                    <label class="photo-overlay" for="fileInput">
                        <i class="fas fa-camera"></i>
                    </label>
                    <input type="file" id="fileInput" accept="image/*">
                </div>
                
                <div class="profile-info">
                    <div class="profile-name" id="displayName">Carregando...</div>
                    <div class="profile-email" id="displayEmail">carregando...</div>
                    <div class="profile-status" id="profileStatus">
                        <i class="fas fa-circle"></i> Disponível
                    </div>
                </div>
            </div>
        </div>

        <!-- TIPO DE VEÍCULO -->
        <div class="form-section">
            <div class="section-header">
                <i class="fas fa-motorcycle"></i>
                <h2>Tipo de Serviço</h2>
            </div>
            
            <div class="vehicle-type-selector">
                <div class="vehicle-type-card active" id="typeTaxi">
                    <i class="fas fa-taxi"></i>
                    <span>Táxi</span>
                </div>
                <div class="vehicle-type-card" id="typeMoto">
                    <i class="fas fa-motorcycle"></i>
                    <span>Moto Táxi</span>
                </div>
            </div>
        </div>

        <!-- DADOS PESSOAIS -->
        <div class="form-section">
            <div class="section-header">
                <i class="fas fa-user"></i>
                <h2>Dados Pessoais</h2>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label><i class="fas fa-user-tag"></i> Nome Completo <span class="required">*</span></label>
                    <input type="text" id="fullName" placeholder="Seu nome completo" readonly>
                </div>
                <div class="form-group">
                    <label><i class="fas fa-id-card"></i> CPF <span class="required">*</span></label>
                    <input type="text" id="cpf" placeholder="000.000.000-00" maxlength="14">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label><i class="fas fa-phone-alt"></i> Telefone <span class="required">*</span></label>
                    <input type="tel" id="phone" placeholder="(11) 98765-4321">
                </div>
                <div class="form-group">
                    <label><i class="fas fa-envelope"></i> E-mail</label>
                    <input type="email" id="email" readonly>
                </div>
            </div>

            <div class="form-group full-width">
                <label><i class="fas fa-align-left"></i> Biografia</label>
                <textarea id="bio" placeholder="Fale um pouco sobre você como motorista..." rows="3"></textarea>
            </div>
        </div>

        <!-- SEÇÃO TÁXI -->
        <div id="vehicleTaxiSection">
            <div class="form-section">
                <div class="section-header">
                    <i class="fas fa-taxi"></i>
                    <h2>Dados do Táxi</h2>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label><i class="fas fa-qrcode"></i> Placa <span class="required">*</span></label>
                        <input type="text" id="plate" placeholder="ABC-1234" maxlength="8">
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-car"></i> Modelo <span class="required">*</span></label>
                        <input type="text" id="carModel" placeholder="Ex: Toyota Corolla">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label><i class="fas fa-calendar"></i> Ano <span class="required">*</span></label>
                        <select id="carYear">
                            <option value="">Selecione o ano</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-palette"></i> Cor <span class="required">*</span></label>
                        <select id="carColor">
                            <option value="">Selecione a cor</option>
                            <option value="Preto">Preto</option>
                            <option value="Branco">Branco</option>
                            <option value="Prata">Prata</option>
                            <option value="Cinza">Cinza</option>
                            <option value="Vermelho">Vermelho</option>
                            <option value="Azul">Azul</option>
                            <option value="Verde">Verde</option>
                            <option value="Amarelo">Amarelo</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label><i class="fas fa-hashtag"></i> Número do Alvará</label>
                        <input type="text" id="alvara" placeholder="Ex: 12345/2025">
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-file-contract"></i> Permissão</label>
                        <input type="text" id="permissao" placeholder="Número da permissão">
                    </div>
                </div>

                <div class="form-group full-width">
                    <label><i class="fas fa-images"></i> Fotos do Veículo</label>
                    <div class="photos-grid" id="vehiclePhotos">
                        <div class="photo-upload-box" data-index="0">
                            <i class="fas fa-plus"></i>
                            <span>Frente</span>
                        </div>
                        <div class="photo-upload-box" data-index="1">
                            <i class="fas fa-plus"></i>
                            <span>Traseira</span>
                        </div>
                        <div class="photo-upload-box" data-index="2">
                            <i class="fas fa-plus"></i>
                            <span>Lateral</span>
                        </div>
                        <div class="photo-upload-box" data-index="3">
                            <i class="fas fa-plus"></i>
                            <span>Interior</span>
                        </div>
                        <div class="photo-upload-box" data-index="4">
                            <i class="fas fa-plus"></i>
                            <span>Placa</span>
                        </div>
                    </div>
                    <p style="color: #666; font-size: 0.75rem; margin-top: 0.5rem;">Envie fotos nítidas de todos os ângulos</p>
                </div>
            </div>
        </div>

        <!-- SEÇÃO MOTO -->
        <div id="vehicleMotoSection" style="display: none;">
            <div class="form-section">
                <div class="section-header">
                    <i class="fas fa-motorcycle"></i>
                    <h2>Dados da Moto</h2>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label><i class="fas fa-qrcode"></i> Placa <span class="required">*</span></label>
                        <input type="text" id="motoPlate" placeholder="ABC-1234" maxlength="8">
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-motorcycle"></i> Modelo <span class="required">*</span></label>
                        <input type="text" id="motoModel" placeholder="Ex: Honda CB500X">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label><i class="fas fa-calendar"></i> Ano <span class="required">*</span></label>
                        <select id="motoYear">
                            <option value="">Selecione o ano</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-palette"></i> Cor <span class="required">*</span></label>
                        <select id="motoColor">
                            <option value="">Selecione a cor</option>
                            <option value="Preta">Preta</option>
                            <option value="Branca">Branca</option>
                            <option value="Vermelha">Vermelha</option>
                            <option value="Azul">Azul</option>
                            <option value="Cinza">Cinza</option>
                            <option value="Prata">Prata</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label><i class="fas fa-hashtag"></i> Número do Alvará</label>
                        <input type="text" id="motoAlvara" placeholder="Ex: 12345/2025">
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-helmet-safety"></i> Capacete Extra</label>
                        <select id="motoCapacete">
                            <option value="">Selecione</option>
                            <option value="sim">Sim, tenho 2 capacetes</option>
                            <option value="nao">Não, apenas 1</option>
                        </select>
                    </div>
                </div>

                <div class="form-group full-width">
                    <label><i class="fas fa-images"></i> Fotos da Moto</label>
                    <div class="photos-grid" id="motoPhotos">
                        <div class="photo-upload-box" data-index="0">
                            <i class="fas fa-plus"></i>
                            <span>Frente</span>
                        </div>
                        <div class="photo-upload-box" data-index="1">
                            <i class="fas fa-plus"></i>
                            <span>Lateral</span>
                        </div>
                        <div class="photo-upload-box" data-index="2">
                            <i class="fas fa-plus"></i>
                            <span>Traseira</span>
                        </div>
                        <div class="photo-upload-box" data-index="3">
                            <i class="fas fa-plus"></i>
                            <span>Placa</span>
                        </div>
                        <div class="photo-upload-box" data-index="4">
                            <i class="fas fa-plus"></i>
                            <span>Capacete</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- DOCUMENTOS -->
        <div class="form-section">
            <div class="section-header">
                <i class="fas fa-file-alt"></i>
                <h2>Documentos</h2>
            </div>
            
            <div class="form-group full-width" style="margin-bottom: 1rem;">
                <label>CNH <span class="required">*</span></label>
                <div class="document-upload" id="cnhUpload">
                    <div class="document-icon">
                        <i class="fas fa-id-card"></i>
                    </div>
                    <div class="document-info">
                        <h4>Carteira Nacional de Habilitação</h4>
                        <p id="cnhStatus">Nenhum arquivo enviado</p>
                    </div>
                    <div class="document-status" id="cnhBadge">
                        <i class="fas fa-clock"></i> Pendente
                    </div>
                </div>
            </div>

            <div class="form-group full-width" style="margin-bottom: 1rem;">
                <label>CRLV</label>
                <div class="document-upload" id="crlvUpload">
                    <div class="document-icon">
                        <i class="fas fa-file-invoice"></i>
                    </div>
                    <div class="document-info">
                        <h4>Certificado de Registro e Licenciamento</h4>
                        <p id="crlvStatus">Nenhum arquivo enviado</p>
                    </div>
                    <div class="document-status" id="crlvBadge">
                        <i class="fas fa-clock"></i> Pendente
                    </div>
                </div>
            </div>

            <div class="form-group full-width">
                <label>Comprovante de Residência</label>
                <div class="document-upload" id="addressUpload">
                    <div class="document-icon">
                        <i class="fas fa-home"></i>
                    </div>
                    <div class="document-info">
                        <h4>Comprovante de Endereço</h4>
                        <p id="addressStatus">Nenhum arquivo enviado</p>
                    </div>
                    <div class="document-status" id="addressBadge">
                        <i class="fas fa-clock"></i> Pendente
                    </div>
                </div>
            </div>
        </div>

        <!-- PREFERÊNCIAS -->
        <div class="form-section">
            <div class="section-header">
                <i class="fas fa-cog"></i>
                <h2>Preferências</h2>
            </div>
            
            <div class="toggle-group">
                <div class="toggle-info">
                    <h4><i class="fab fa-whatsapp" style="color: #25D366;"></i> Notificações WhatsApp</h4>
                    <p>Receber avisos de novas corridas</p>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" id="notifyWhatsApp">
                    <span class="toggle-slider"></span>
                </label>
            </div>

            <div class="toggle-group" style="margin-top: 1rem;">
                <div class="toggle-info">
                    <h4 style="color: #E74C3C;"><i class="fas fa-power-off"></i> Desativar Conta</h4>
                    <p>Não receber novas solicitações</p>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" id="deactivateAccount">
                    <span class="toggle-slider"></span>
                </label>
            </div>
        </div>

        <!-- BOTÕES -->
        <div class="form-actions">
            <button class="btn-secondary" id="btnReset">
                <i class="fas fa-undo-alt"></i> Limpar
            </button>
            <button class="btn-primary" id="btnSave">
                <i class="fas fa-save"></i> Salvar Perfil
            </button>
        </div>
    </main>

    <!-- TOAST -->
    <div class="toast" id="toast">
        <div class="toast-icon">
            <i class="fas fa-info-circle"></i>
        </div>
        <div class="toast-content">
            <h4 id="toastTitle">Notificação</h4>
            <p id="toastMessage">Mensagem</p>
        </div>
    </div>

    <!-- LOADING -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
        <p style="color: #888;" id="loadingMessage">Carregando...</p>
    </div>

    <!-- INPUTS OCULTOS PARA UPLOAD -->
    <input type="file" id="vehiclePhotoInput" accept="image/*" style="display: none;">
    <input type="file" id="motoPhotoInput" accept="image/*" style="display: none;">
    <input type="file" id="documentInput" accept="image/*" style="display: none;">

    <!-- FIREBASE + SCRIPT PRINCIPAL -->
    <script type="module">
        // ==========================================
        // CONFIGURAÇÃO FIREBASE - COLE SEUS DADOS AQUI!
        // ==========================================
        const firebaseConfig = {
            apiKey: "SUA_API_KEY",
            authDomain: "SEU_AUTH_DOMAIN",
            projectId: "SEU_PROJECT_ID",
            storageBucket: "SEU_STORAGE_BUCKET",
            messagingSenderId: "SEU_SENDER_ID",
            appId: "SEU_APP_ID"
        };

        // ==========================================
        // INICIALIZAÇÃO FIREBASE
        // ==========================================
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { 
            getAuth, 
            onAuthStateChanged,
            signOut 
        } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { 
            getFirestore, 
            doc, 
            getDoc,
            updateDoc,
            setDoc,
            collection,
            query,
            where,
            getDocs
        } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // ==========================================
        // CONFIGURAÇÃO IMGUR
        // ==========================================
        const IMGUR_CLIENT_ID = '546c25a59c58ad7';

        // ==========================================
        // VARIÁVEIS GLOBAIS
        // ==========================================
        let currentUser = null;
        let userData = {
            uid: '',
            email: '',
            fullName: '',
            cpf: '',
            phone: '',
            bio: '',
            userType: 'taxi',
            photoURL: null,
            vehicle: {
                plate: '',
                model: '',
                year: '',
                color: '',
                alvara: '',
                permissao: '',
                photos: [null, null, null, null, null]
            },
            moto: {
                plate: '',
                model: '',
                year: '',
                color: '',
                alvara: '',
                capacete: '',
                photos: [null, null, null, null, null]
            },
            documents: {
                cnh: null,
                crlv: null,
                address: null
            },
            preferences: {
                notifyWhatsApp: true
            },
            status: 'available',
            stats: {
                totalRides: 0,
                rating: 0,
                favorites: 0,
                todayRides: 0
            },
            createdAt: null,
            updatedAt: null,
            lastStatusUpdate: null
        };

        let taxiPhotos = [null, null, null, null, null];
        let motoPhotos = [null, null, null, null, null];
        let currentPhotoIndex = null;
        let currentPhotoType = null;
        let currentDocumentType = null;

        // ==========================================
        // ELEMENTOS DOM
        // ==========================================
        const elements = {
            navAvatar: document.getElementById('navAvatar'),
            profilePlaceholder: document.getElementById('profilePlaceholder'),
            profilePhoto: document.getElementById('profilePhoto'),
            fileInput: document.getElementById('fileInput'),
            displayName: document.getElementById('displayName'),
            displayEmail: document.getElementById('displayEmail'),
            profileStatus: document.getElementById('profileStatus'),
            fullName: document.getElementById('fullName'),
            cpf: document.getElementById('cpf'),
            phone: document.getElementById('phone'),
            email: document.getElementById('email'),
            bio: document.getElementById('bio'),
            typeTaxi: document.getElementById('typeTaxi'),
            typeMoto: document.getElementById('typeMoto'),
            vehicleTaxiSection: document.getElementById('vehicleTaxiSection'),
            vehicleMotoSection: document.getElementById('vehicleMotoSection'),
            plate: document.getElementById('plate'),
            carModel: document.getElementById('carModel'),
            carYear: document.getElementById('carYear'),
            carColor: document.getElementById('carColor'),
            alvara: document.getElementById('alvara'),
            permissao: document.getElementById('permissao'),
            motoPlate: document.getElementById('motoPlate'),
            motoModel: document.getElementById('motoModel'),
            motoYear: document.getElementById('motoYear'),
            motoColor: document.getElementById('motoColor'),
            motoAlvara: document.getElementById('motoAlvara'),
            motoCapacete: document.getElementById('motoCapacete'),
            notifyWhatsApp: document.getElementById('notifyWhatsApp'),
            deactivateAccount: document.getElementById('deactivateAccount'),
            btnSave: document.getElementById('btnSave'),
            btnReset: document.getElementById('btnReset'),
            btnLogout: document.getElementById('btnLogout'),
            toast: document.getElementById('toast'),
            toastTitle: document.getElementById('toastTitle'),
            toastMessage: document.getElementById('toastMessage'),
            loadingOverlay: document.getElementById('loadingOverlay'),
            loadingMessage: document.getElementById('loadingMessage'),
            vehiclePhotoInput: document.getElementById('vehiclePhotoInput'),
            motoPhotoInput: document.getElementById('motoPhotoInput'),
            documentInput: document.getElementById('documentInput'),
            cnhStatus: document.getElementById('cnhStatus'),
            cnhBadge: document.getElementById('cnhBadge'),
            crlvStatus: document.getElementById('crlvStatus'),
            crlvBadge: document.getElementById('crlvBadge'),
            addressStatus: document.getElementById('addressStatus'),
            addressBadge: document.getElementById('addressBadge')
        };

        // ==========================================
        // FUNÇÕES UTILITÁRIAS
        // ==========================================
        
        function showLoading(message = 'Carregando...') {
            if (elements.loadingMessage) elements.loadingMessage.textContent = message;
            elements.loadingOverlay.classList.add('active');
        }

        function hideLoading() {
            elements.loadingOverlay.classList.remove('active');
        }

        function showToast(title, message, type = 'info') {
            elements.toastTitle.textContent = title;
            elements.toastMessage.textContent = message;
            
            elements.toast.className = 'toast show';
            elements.toast.classList.add(type);
            
            const icon = elements.toast.querySelector('.toast-icon i');
            if (type === 'success') icon.className = 'fas fa-check-circle';
            else if (type === 'error') icon.className = 'fas fa-exclamation-circle';
            else if (type === 'warning') icon.className = 'fas fa-exclamation-triangle';
            else icon.className = 'fas fa-info-circle';
            
            setTimeout(() => elements.toast.classList.remove('show'), 3500);
        }

        function converterParaBase64(arquivo) {
            return new Promise((resolve, reject) => {
                const leitor = new FileReader();
                leitor.onload = () => resolve(leitor.result);
                leitor.onerror = reject;
                leitor.readAsDataURL(arquivo);
            });
        }

        // ==========================================
        // UPLOAD PARA IMGUR
        // ==========================================
        async function uploadParaImgur(arquivo) {
            try {
                const base64 = await converterParaBase64(arquivo);
                const base64Data = base64.split(',')[1];
                
                const formData = new FormData();
                formData.append('image', base64Data);
                
                const resposta = await fetch('https://api.imgur.com/3/image', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Client-ID ${IMGUR_CLIENT_ID}`
                    },
                    body: formData
                });
                
                const dados = await resposta.json();
                
                if (dados.success) {
                    return dados.data.link;
                } else {
                    throw new Error('Erro no upload');
                }
            } catch (erro) {
                console.error('Erro Imgur:', erro);
                throw erro;
            }
        }

        // ==========================================
        // CARREGAR DADOS DO USUÁRIO
        // ==========================================
        async function carregarDadosUsuario() {
            if (!currentUser) return;
            
            showLoading('Carregando seu perfil...');
            
            try {
                // 1. PRIMEIRO: Buscar na coleção /users (dados do auth)
                const userRef = doc(db, "users", currentUser.uid);
                const userDoc = await getDoc(userRef);
                
                if (userDoc.exists()) {
                    const dados = userDoc.data();
                    
                    // Dados obrigatórios do auth
                    userData.uid = currentUser.uid;
                    userData.email = dados.email || currentUser.email || '';
                    userData.fullName = dados.fullName || dados.nomeCompleto || '';
                    userData.phone = dados.phone || dados.celular || '';
                    userData.createdAt = dados.createdAt || new Date().toISOString();
                    
                    // Preencher campos readonly
                    if (elements.fullName) elements.fullName.value = userData.fullName;
                    if (elements.email) elements.email.value = userData.email;
                }
                
                // 2. SEGUNDO: Buscar na coleção /taxistasPerfil (dados do motorista)
                const taxistaRef = doc(db, "taxistasPerfil", currentUser.uid);
                const taxistaDoc = await getDoc(taxistaRef);
                
                if (taxistaDoc.exists()) {
                    const dados = taxistaDoc.data();
                    
                    // Sobrescrever com dados do taxista
                    userData = { ...userData, ...dados };
                    
                    // Dados pessoais
                    if (dados.cpf) userData.cpf = dados.cpf;
                    if (dados.bio) userData.bio = dados.bio;
                    if (dados.photoURL) userData.photoURL = dados.photoURL;
                    if (dados.userType) userData.userType = dados.userType;
                    if (dados.status) userData.status = dados.status;
                    if (dados.preferences) userData.preferences = { ...userData.preferences, ...dados.preferences };
                    if (dados.stats) userData.stats = { ...userData.stats, ...dados.stats };
                    
                    // Dados do veículo (táxi)
                    if (dados.vehicle) {
                        userData.vehicle = { ...userData.vehicle, ...dados.vehicle };
                        if (dados.vehicle.photos) taxiPhotos = [...dados.vehicle.photos];
                    }
                    
                    // Dados da moto
                    if (dados.moto) {
                        userData.moto = { ...userData.moto, ...dados.moto };
                        if (dados.moto.photos) motoPhotos = [...dados.moto.photos];
                    }
                    
                    // Documentos
                    if (dados.documents) {
                        userData.documents = { ...userData.documents, ...dados.documents };
                    }
                } else {
                    // Criar documento se não existir
                    await setDoc(taxistaRef, {
                        uid: currentUser.uid,
                        email: userData.email,
                        fullName: userData.fullName,
                        phone: userData.phone,
                        userType: 'taxi',
                        status: 'available',
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString(),
                        stats: {
                            totalRides: 0,
                            rating: 0,
                            favorites: 0,
                            todayRides: 0
                        }
                    });
                }
                
                // Atualizar UI
                preencherFormulario();
                atualizarDisplayPerfil();
                
            } catch (erro) {
                console.error('Erro ao carregar dados:', erro);
                showToast('Erro', 'Falha ao carregar dados do perfil', 'error');
            } finally {
                hideLoading();
            }
        }

        // ==========================================
        // PREENCHER FORMULÁRIO
        // ==========================================
        function preencherFormulario() {
            // Dados pessoais
            if (elements.fullName) elements.fullName.value = userData.fullName || '';
            if (elements.cpf) elements.cpf.value = userData.cpf || '';
            if (elements.phone) elements.phone.value = userData.phone || '';
            if (elements.email) elements.email.value = userData.email || '';
            if (elements.bio) elements.bio.value = userData.bio || '';
            
            // Dados do táxi
            if (elements.plate) elements.plate.value = userData.vehicle?.plate || '';
            if (elements.carModel) elements.carModel.value = userData.vehicle?.model || '';
            if (elements.carYear) elements.carYear.value = userData.vehicle?.year || '';
            if (elements.carColor) elements.carColor.value = userData.vehicle?.color || '';
            if (elements.alvara) elements.alvara.value = userData.vehicle?.alvara || '';
            if (elements.permissao) elements.permissao.value = userData.vehicle?.permissao || '';
            
            // Dados da moto
            if (elements.motoPlate) elements.motoPlate.value = userData.moto?.plate || '';
            if (elements.motoModel) elements.motoModel.value = userData.moto?.model || '';
            if (elements.motoYear) elements.motoYear.value = userData.moto?.year || '';
            if (elements.motoColor) elements.motoColor.value = userData.moto?.color || '';
            if (elements.motoAlvara) elements.motoAlvara.value = userData.moto?.alvara || '';
            if (elements.motoCapacete) elements.motoCapacete.value = userData.moto?.capacete || '';
            
            // Preferências
            if (elements.notifyWhatsApp) elements.notifyWhatsApp.checked = userData.preferences?.notifyWhatsApp !== false;
            if (elements.deactivateAccount) elements.deactivateAccount.checked = userData.status === 'inactive';
            
            // Tipo de veículo
            setVehicleType(userData.userType || 'taxi');
            
            // Foto de perfil
            if (userData.photoURL) {
                displayProfilePhoto(userData.photoURL);
            } else {
                const initials = getInitials();
                if (elements.profilePlaceholder) elements.profilePlaceholder.textContent = initials;
                if (elements.profilePhoto) elements.profilePhoto.style.display = 'none';
                if (elements.profilePlaceholder) elements.profilePlaceholder.style.display = 'flex';
            }
            
            // Fotos do táxi
            if (taxiPhotos) {
                taxiPhotos.forEach((url, index) => {
                    if (url) displayVehiclePhoto(url, index);
                });
            }
            
            // Fotos da moto
            if (motoPhotos) {
                motoPhotos.forEach((url, index) => {
                    if (url) displayMotoPhoto(url, index);
                });
            }
            
            // Documentos
            if (userData.documents) {
                if (userData.documents.cnh) {
                    if (elements.cnhStatus) elements.cnhStatus.textContent = userData.documents.cnh.name || 'Documento enviado';
                    if (elements.cnhBadge) {
                        elements.cnhBadge.innerHTML = '<i class="fas fa-check-circle"></i> Enviado';
                        elements.cnhBadge.classList.add('verified');
                    }
                }
                if (userData.documents.crlv) {
                    if (elements.crlvStatus) elements.crlvStatus.textContent = userData.documents.crlv.name || 'Documento enviado';
                    if (elements.crlvBadge) {
                        elements.crlvBadge.innerHTML = '<i class="fas fa-check-circle"></i> Enviado';
                        elements.crlvBadge.classList.add('verified');
                    }
                }
                if (userData.documents.address) {
                    if (elements.addressStatus) elements.addressStatus.textContent = userData.documents.address.name || 'Documento enviado';
                    if (elements.addressBadge) {
                        elements.addressBadge.innerHTML = '<i class="fas fa-check-circle"></i> Enviado';
                        elements.addressBadge.classList.add('verified');
                    }
                }
            }
        }

        // ==========================================
        // ATUALIZAR DISPLAY DO PERFIL
        // ==========================================
        function atualizarDisplayPerfil() {
            const name = userData.fullName || 'Motorista';
            const email = userData.email || 'Não informado';
            const initials = getInitials();
            
            if (elements.displayName) elements.displayName.textContent = name;
            if (elements.displayEmail) elements.displayEmail.textContent = email;
            if (elements.navAvatar) elements.navAvatar.textContent = initials;
            
            if (!userData.photoURL && elements.profilePlaceholder) {
                elements.profilePlaceholder.textContent = initials;
            }
            
            if (elements.profileStatus) {
                if (userData.status === 'inactive') {
                    elements.profileStatus.className = 'profile-status inactive';
                    elements.profileStatus.innerHTML = '<i class="fas fa-circle"></i> Inativo';
                } else {
                    elements.profileStatus.className = 'profile-status';
                    elements.profileStatus.innerHTML = '<i class="fas fa-circle"></i> Disponível';
                }
            }
        }

        function getInitials() {
            if (userData.fullName) {
                return userData.fullName.split(' ')
                    .map(n => n[0])
                    .join('')
                    .substring(0, 2)
                    .toUpperCase();
            }
            return 'TX';
        }

        // ==========================================
        // FOTO DE PERFIL
        // ==========================================
        function displayProfilePhoto(url) {
            if (elements.profilePhoto && url) {
                elements.profilePhoto.src = url;
                elements.profilePhoto.style.display = 'block';
                if (elements.profilePlaceholder) elements.profilePlaceholder.style.display = 'none';
            }
        }

        async function handlePhotoUpload(file) {
            if (!file) return;
            
            if (!file.type.startsWith('image/')) {
                showToast('Erro', 'Selecione uma imagem válida', 'error');
                return;
            }
            
            if (file.size > 5 * 1024 * 1024) {
                showToast('Erro', 'A imagem deve ter no máximo 5MB', 'error');
                return;
            }
            
            const leitor = new FileReader();
            leitor.onload = (e) => displayProfilePhoto(e.target.result);
            leitor.readAsDataURL(file);
            
            showLoading('Enviando foto...');
            
            try {
                const url = await uploadParaImgur(file);
                
                userData.photoURL = url;
                
                const taxistaRef = doc(db, "taxistasPerfil", currentUser.uid);
                await updateDoc(taxistaRef, {
                    photoURL: url,
                    updatedAt: new Date().toISOString()
                });
                
                displayProfilePhoto(url);
                showToast('Sucesso', 'Foto de perfil atualizada', 'success');
                
            } catch (erro) {
                showToast('Erro', 'Falha ao enviar imagem', 'error');
            } finally {
                hideLoading();
            }
        }

        // ==========================================
        // FOTOS DO TÁXI
        // ==========================================
        function displayVehiclePhoto(url, index) {
            const boxes = document.querySelectorAll('#vehiclePhotos .photo-upload-box');
            if (!boxes[index]) return;
            
            const box = boxes[index];
            const labels = ['Frente', 'Traseira', 'Lateral', 'Interior', 'Placa'];
            
            box.innerHTML = `
                <img src="${url}" alt="Foto ${labels[index]}">
                <button class="photo-remove" data-type="taxi" data-index="${index}">
                    <i class="fas fa-times"></i>
                </button>
            `;
            box.classList.add('has-image');
        }

        async function handleVehiclePhotoUpload(file, index) {
            if (!file) return;
            
            if (!file.type.startsWith('image/')) {
                showToast('Erro', 'Selecione uma imagem', 'error');
                return;
            }
            
            if (file.size > 5 * 1024 * 1024) {
                showToast('Erro', 'A imagem deve ter no máximo 5MB', 'error');
                return;
            }
            
            const leitor = new FileReader();
            leitor.onload = (e) => displayVehiclePhoto(e.target.result, index);
            leitor.readAsDataURL(file);
            
            showLoading('Enviando foto...');
            
            try {
                const url = await uploadParaImgur(file);
                
                taxiPhotos[index] = url;
                userData.vehicle.photos = taxiPhotos;
                
                const taxistaRef = doc(db, "taxistasPerfil", currentUser.uid);
                await updateDoc(taxistaRef, {
                    'vehicle.photos': taxiPhotos,
                    updatedAt: new Date().toISOString()
                });
                
                displayVehiclePhoto(url, index);
                showToast('Sucesso', 'Foto adicionada', 'success');
                
            } catch (erro) {
                showToast('Erro', 'Falha ao enviar imagem', 'error');
            } finally {
                hideLoading();
            }
        }

        async function removeVehiclePhoto(index) {
            if (!confirm('Remover esta foto?')) return;
            
            taxiPhotos[index] = null;
            userData.vehicle.photos = taxiPhotos;
            
            try {
                const taxistaRef = doc(db, "taxistasPerfil", currentUser.uid);
                await updateDoc(taxistaRef, {
                    'vehicle.photos': taxiPhotos,
                    updatedAt: new Date().toISOString()
                });
                
                const boxes = document.querySelectorAll('#vehiclePhotos .photo-upload-box');
                const box = boxes[index];
                const labels = ['Frente', 'Traseira', 'Lateral', 'Interior', 'Placa'];
                
                box.innerHTML = `
                    <i class="fas fa-plus"></i>
                    <span>${labels[index]}</span>
                `;
                box.classList.remove('has-image');
                
                showToast('Sucesso', 'Foto removida', 'success');
                
            } catch (erro) {
                showToast('Erro', 'Falha ao remover foto', 'error');
            }
        }

        // ==========================================
        // FOTOS DA MOTO
        // ==========================================
        function displayMotoPhoto(url, index) {
            const boxes = document.querySelectorAll('#motoPhotos .photo-upload-box');
            if (!boxes[index]) return;
            
            const box = boxes[index];
            const labels = ['Frente', 'Lateral', 'Traseira', 'Placa', 'Capacete'];
            
            box.innerHTML = `
                <img src="${url}" alt="Foto ${labels[index]}">
                <button class="photo-remove" data-type="moto" data-index="${index}">
                    <i class="fas fa-times"></i>
                </button>
            `;
            box.classList.add('has-image');
        }

        async function handleMotoPhotoUpload(file, index) {
            if (!file) return;
            
            if (!file.type.startsWith('image/')) {
                showToast('Erro', 'Selecione uma imagem', 'error');
                return;
            }
            
            if (file.size > 5 * 1024 * 1024) {
                showToast('Erro', 'A imagem deve ter no máximo 5MB', 'error');
                return;
            }
            
            const leitor = new FileReader();
            leitor.onload = (e) => displayMotoPhoto(e.target.result, index);
            leitor.readAsDataURL(file);
            
            showLoading('Enviando foto...');
            
            try {
                const url = await uploadParaImgur(file);
                
                motoPhotos[index] = url;
                userData.moto.photos = motoPhotos;
                
                const taxistaRef = doc(db, "taxistasPerfil", currentUser.uid);
                await updateDoc(taxistaRef, {
                    'moto.photos': motoPhotos,
                    updatedAt: new Date().toISOString()
                });
                
                displayMotoPhoto(url, index);
                showToast('Sucesso', 'Foto adicionada', 'success');
                
            } catch (erro) {
                showToast('Erro', 'Falha ao enviar imagem', 'error');
            } finally {
                hideLoading();
            }
        }

        async function removeMotoPhoto(index) {
            if (!confirm('Remover esta foto?')) return;
            
            motoPhotos[index] = null;
            userData.moto.photos = motoPhotos;
            
            try {
                const taxistaRef = doc(db, "taxistasPerfil", currentUser.uid);
                await updateDoc(taxistaRef, {
                    'moto.photos': motoPhotos,
                    updatedAt: new Date().toISOString()
                });
                
                const boxes = document.querySelectorAll('#motoPhotos .photo-upload-box');
                const box = boxes[index];
                const labels = ['Frente', 'Lateral', 'Traseira', 'Placa', 'Capacete'];
                
                box.innerHTML = `
                    <i class="fas fa-plus"></i>
                    <span>${labels[index]}</span>
                `;
                box.classList.remove('has-image');
                
                showToast('Sucesso', 'Foto removida', 'success');
                
            } catch (erro) {
                showToast('Erro', 'Falha ao remover foto', 'error');
            }
        }

        // ==========================================
        // DOCUMENTOS
        // ==========================================
        async function handleDocumentUpload(file, type) {
            if (!file) return;
            
            if (!file.type.startsWith('image/')) {
                showToast('Erro', 'Envie apenas imagens (JPG, PNG)', 'error');
                return;
            }
            
            if (file.size > 10 * 1024 * 1024) {
                showToast('Erro', 'Arquivo muito grande. Máximo 10MB', 'error');
                return;
            }
            
            showLoading('Enviando documento...');
            
            try {
                const url = await uploadParaImgur(file);
                
                const docData = {
                    url: url,
                    name: file.name,
                    type: file.type,
                    size: file.size,
                    uploadedAt: new Date().toISOString(),
                    status: 'pending'
                };
                
                userData.documents[type] = docData;
                
                const taxistaRef = doc(db, "taxistasPerfil", currentUser.uid);
                await updateDoc(taxistaRef, {
                    [`documents.${type}`]: docData,
                    updatedAt: new Date().toISOString()
                });
                
                const statusEl = document.getElementById(`${type}Status`);
                const badgeEl = document.getElementById(`${type}Badge`);
                
                if (statusEl) {
                    statusEl.textContent = file.name.length > 40 ? file.name.substring(0, 40) + '...' : file.name;
                }
                if (badgeEl) {
                    badgeEl.innerHTML = '<i class="fas fa-check-circle"></i> Enviado';
                    badgeEl.classList.add('verified');
                }
                
                showToast('Sucesso', 'Documento enviado', 'success');
                
            } catch (erro) {
                showToast('Erro', 'Falha ao enviar documento', 'error');
            } finally {
                hideLoading();
            }
        }

        // ==========================================
        // TIPO DE VEÍCULO
        // ==========================================
        function setVehicleType(type) {
            userData.userType = type;
            
            if (type === 'taxi') {
                if (elements.typeTaxi) elements.typeTaxi.classList.add('active');
                if (elements.typeMoto) elements.typeMoto.classList.remove('active');
                if (elements.vehicleTaxiSection) elements.vehicleTaxiSection.style.display = 'block';
                if (elements.vehicleMotoSection) elements.vehicleMotoSection.style.display = 'none';
            } else {
                if (elements.typeMoto) elements.typeMoto.classList.add('active');
                if (elements.typeTaxi) elements.typeTaxi.classList.remove('active');
                if (elements.vehicleMotoSection) elements.vehicleMotoSection.style.display = 'block';
                if (elements.vehicleTaxiSection) elements.vehicleTaxiSection.style.display = 'none';
            }
        }

        // ==========================================
        // SALVAR PERFIL
        // ==========================================
        async function saveProfile() {
            if (!currentUser) {
                showToast('Erro', 'Usuário não autenticado', 'error');
                return;
            }
            
            if (!validateForm()) return;
            
            showLoading('Salvando perfil...');
            
            try {
                // Coletar dados do formulário
                const dadosAtualizados = {
                    cpf: elements.cpf.value,
                    phone: elements.phone.value,
                    bio: elements.bio.value,
                    userType: userData.userType,
                    preferences: {
                        notifyWhatsApp: elements.notifyWhatsApp.checked
                    },
                    status: elements.deactivateAccount.checked ? 'inactive' : 'available',
                    updatedAt: new Date().toISOString(),
                    lastStatusUpdate: new Date().toISOString()
                };
                
                // Dados do táxi
                if (userData.userType === 'taxi') {
                    dadosAtualizados.vehicle = {
                        plate: elements.plate.value.toUpperCase(),
                        model: elements.carModel.value,
                        year: elements.carYear.value,
                        color: elements.carColor.value,
                        alvara: elements.alvara.value,
                        permissao: elements.permissao.value,
                        photos: taxiPhotos
                    };
                } else {
                    dadosAtualizados.moto = {
                        plate: elements.motoPlate.value.toUpperCase(),
                        model: elements.motoModel.value,
                        year: elements.motoYear.value,
                        color: elements.motoColor.value,
                        alvara: elements.motoAlvara.value,
                        capacete: elements.motoCapacete.value,
                        photos: motoPhotos
                    };
                }
                
                // Atualizar Firestore
                const taxistaRef = doc(db, "taxistasPerfil", currentUser.uid);
                await updateDoc(taxistaRef, dadosAtualizados);
                
                // Atualizar objeto local
                Object.assign(userData, dadosAtualizados);
                
                atualizarDisplayPerfil();
                showToast('Sucesso', 'Perfil salvo com sucesso', 'success');
                
            } catch (erro) {
                console.error('Erro ao salvar:', erro);
                showToast('Erro', 'Falha ao salvar perfil', 'error');
            } finally {
                hideLoading();
            }
        }

        // ==========================================
        // VALIDAÇÃO
        // ==========================================
        function validateForm() {
            let valid = true;
            const required = ['cpf', 'phone'];
            
            if (userData.userType === 'taxi') {
                required.push('plate', 'carModel', 'carYear', 'carColor');
            } else {
                required.push('motoPlate', 'motoModel', 'motoYear', 'motoColor');
            }
            
            required.forEach(id => {
                const el = document.getElementById(id);
                if (el && !el.value.trim()) {
                    el.classList.add('error');
                    valid = false;
                } else if (el) {
                    el.classList.remove('error');
                }
            });
            
            if (!valid) {
                showToast('Atenção', 'Preencha todos os campos obrigatórios', 'warning');
            }
            
            return valid;
        }

        // ==========================================
        // RESET FORM
        // ==========================================
        function resetForm() {
            if (confirm('Limpar todas as alterações não salvas?')) {
                preencherFormulario();
                showToast('Info', 'Formulário restaurado', 'info');
            }
        }

        // ==========================================
        // POPULAR ANOS
        // ==========================================
        function populateYears() {
            const currentYear = new Date().getFullYear();
            
            ['carYear', 'motoYear'].forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    select.innerHTML = '<option value="">Selecione o ano</option>';
                    for (let year = currentYear; year >= 2000; year--) {
                        const option = document.createElement('option');
                        option.value = year;
                        option.textContent = year;
                        select.appendChild(option);
                    }
                }
            });
        }

        // ==========================================
        // MÁSCARAS
        // ==========================================
        function maskCPF(e) {
            let v = e.target.value.replace(/\D/g, '').substring(0, 11);
            v = v.replace(/(\d{3})(\d)/, '$1.$2');
            v = v.replace(/(\d{3})(\d)/, '$1.$2');
            v = v.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
            e.target.value = v;
        }

        function maskPhone(e) {
            let v = e.target.value.replace(/\D/g, '').substring(0, 11);
            if (v.length === 11) {
                v = v.replace(/^(\d{2})(\d{5})(\d{4})$/, '($1) $2-$3');
            } else if (v.length === 10) {
                v = v.replace(/^(\d{2})(\d{4})(\d{4})$/, '($1) $2-$3');
            } else if (v.length > 2) {
                v = v.replace(/^(\d{2})(\d)/, '($1) $2');
            }
            e.target.value = v;
        }

        function maskPlate(e) {
            let v = e.target.value.toUpperCase().replace(/[^A-Z0-9]/g, '').substring(0, 7);
            if (v.length === 7) {
                if (/^[A-Z]{3}[0-9][A-Z][0-9]{2}$/.test(v)) {
                    v = v.replace(/^([A-Z]{3})([0-9])([A-Z])([0-9]{2})$/, '$1$2$3$4');
                } else {
                    v = v.replace(/^([A-Z]{3})(\d{4})$/, '$1-$2');
                }
            } else if (v.length > 3) {
                v = v.replace(/^([A-Z]{3})(.+)$/, '$1-$2');
            }
            e.target.value = v;
        }

        // ==========================================
        // LOGOUT
        // ==========================================
        async function logout() {
            if (confirm('Deseja sair da sua conta?')) {
                try {
                    await signOut(auth);
                    window.location.href = 'login.html';
                } catch (erro) {
                    showToast('Erro', 'Falha ao sair', 'error');
                }
            }
        }

        // ==========================================
        // EVENT LISTENERS
        // ==========================================
        function setupEventListeners() {
            
            // Foto de perfil
            if (elements.fileInput) {
                elements.fileInput.addEventListener('change', (e) => {
                    handlePhotoUpload(e.target.files[0]);
                });
            }
            
            // Fotos do táxi
            document.querySelectorAll('#vehiclePhotos .photo-upload-box').forEach(box => {
                box.addEventListener('click', function(e) {
                    if (e.target.classList.contains('photo-remove')) {
                        return;
                    }
                    const index = parseInt(this.dataset.index);
                    currentPhotoType = 'taxi';
                    currentPhotoIndex = index;
                    if (elements.vehiclePhotoInput) {
                        elements.vehiclePhotoInput.click();
                    }
                });
            });
            
            // Fotos da moto
            document.querySelectorAll('#motoPhotos .photo-upload-box').forEach(box => {
                box.addEventListener('click', function(e) {
                    if (e.target.classList.contains('photo-remove')) {
                        return;
                    }
                    const index = parseInt(this.dataset.index);
                    currentPhotoType = 'moto';
                    currentPhotoIndex = index;
                    if (elements.motoPhotoInput) {
                        elements.motoPhotoInput.click();
                    }
                });
            });
            
            // Upload de fotos do táxi
            if (elements.vehiclePhotoInput) {
                elements.vehiclePhotoInput.addEventListener('change', (e) => {
                    if (currentPhotoType === 'taxi' && currentPhotoIndex !== null) {
                        handleVehiclePhotoUpload(e.target.files[0], currentPhotoIndex);
                    }
                    e.target.value = '';
                });
            }
            
            // Upload de fotos da moto
            if (elements.motoPhotoInput) {
                elements.motoPhotoInput.addEventListener('change', (e) => {
                    if (currentPhotoType === 'moto' && currentPhotoIndex !== null) {
                        handleMotoPhotoUpload(e.target.files[0], currentPhotoIndex);
                    }
                    e.target.value = '';
                });
            }
            
            // Remover fotos (delegação)
            document.addEventListener('click', function(e) {
                const btn = e.target.closest('.photo-remove');
                if (!btn) return;
                
                const type = btn.dataset.type;
                const index = parseInt(btn.dataset.index);
                
                if (type === 'taxi') {
                    removeVehiclePhoto(index);
                } else if (type === 'moto') {
                    removeMotoPhoto(index);
                }
            });
            
            // Documentos
            if (document.getElementById('cnhUpload')) {
                document.getElementById('cnhUpload').addEventListener('click', () => {
                    currentDocumentType = 'cnh';
                    if (elements.documentInput) elements.documentInput.click();
                });
            }
            
            if (document.getElementById('crlvUpload')) {
                document.getElementById('crlvUpload').addEventListener('click', () => {
                    currentDocumentType = 'crlv';
                    if (elements.documentInput) elements.documentInput.click();
                });
            }
            
            if (document.getElementById('addressUpload')) {
                document.getElementById('addressUpload').addEventListener('click', () => {
                    currentDocumentType = 'address';
                    if (elements.documentInput) elements.documentInput.click();
                });
            }
            
            if (elements.documentInput) {
                elements.documentInput.addEventListener('change', (e) => {
                    if (currentDocumentType) {
                        handleDocumentUpload(e.target.files[0], currentDocumentType);
                    }
                    e.target.value = '';
                });
            }
            
            // Tipo de veículo
            if (elements.typeTaxi) {
                elements.typeTaxi.addEventListener('click', () => setVehicleType('taxi'));
            }
            if (elements.typeMoto) {
                elements.typeMoto.addEventListener('click', () => setVehicleType('moto'));
            }
            
            // Botões
            if (elements.btnSave) {
                elements.btnSave.addEventListener('click', saveProfile);
            }
            if (elements.btnReset) {
                elements.btnReset.addEventListener('click', resetForm);
            }
            if (elements.btnLogout) {
                elements.btnLogout.addEventListener('click', logout);
            }
            
            // Máscaras
            if (elements.cpf) {
                elements.cpf.addEventListener('input', maskCPF);
            }
            if (elements.phone) {
                elements.phone.addEventListener('input', maskPhone);
            }
            if (elements.plate) {
                elements.plate.addEventListener('input', maskPlate);
            }
            if (elements.motoPlate) {
                elements.motoPlate.addEventListener('input', maskPlate);
            }
            
            // Status checkbox
            if (elements.deactivateAccount) {
                elements.deactivateAccount.addEventListener('change', function() {
                    userData.status = this.checked ? 'inactive' : 'available';
                    atualizarDisplayPerfil();
                });
            }
        }

        // ==========================================
        // AUTH STATE LISTENER
        // ==========================================
        onAuthStateChanged(auth, (usuario) => {
            if (usuario) {
                currentUser = usuario;
                carregarDadosUsuario();
            } else {
                window.location.href = 'login.html';
            }
        });

        // ==========================================
        // INIT
        // ==========================================
        document.addEventListener('DOMContentLoaded', function() {
            populateYears();
            setupEventListeners();
        });
    </script>
</body>
</html>